{{
    config(
        materialized = env_var('DBT_MAT_INCREMENTAL'),
        tags=["hist", "pl","pl_hist"],
        snowflake_warehouse= env_var("DBT_WBX_SF_WH"),
        transient=false,
        unique_key="unique_key",
        pre_hook="""
    
            {% if check_table_exists( this.schema, this.table ) == 'True' %}
                truncate table {{ this }}
            {% endif %}  

            """,
    )
}}


with int as(
    select * from {{ref('int_f_wbx_sls_pl_ibehist')}}
)

select 
unique_key,
source_system,
date,
Trade_Type,
sku,
item_guid,
company_code,
primary_uom,
transaction_uom,
transaction_currency,
base_currency,
phi_currency,
pcomp_currency,
uom_conversion_rt,
txn_conv_rt,
base_conv_rt,
phi_conv_rt,
pcomp_conv_rt,
volume,
base_gross_selling_value,
phi_gross_selling_value,
pcomp_gross_selling_value,
txn_gross_selling_value,
base_added_value_pack,
phi_added_value_pack,
pcomp_added_value_pack,
txn_added_value_pack,
base_growth_incentives,
phi_growth_incentives,
pcomp_growth_incentives,
txn_growth_incentives,
base_edlp,
phi_edlp,
pcomp_edlp,
txn_edlp,
base_early_settlement_discount,
phi_early_settlement_discount,
pcomp_early_settlement_discount,
txn_early_settlement_discount,
base_rsa_incentives,
phi_rsa_incentives,
pcomp_rsa_incentives,
txn_rsa_incentives,
base_retro,
phi_retro,
pcomp_retro,
txn_retro,
base_avp_discount,
phi_avp_discount,
pcomp_avp_discount,
txn_avp_discount,
base_off_invoice,
phi_off_invoice,
pcomp_off_invoice,
txn_off_invoice,
base_promo_fixed_funding,
phi_promo_fixed_funding,
pcomp_promo_fixed_funding,
txn_promo_fixed_funding,
base_fixed_annual_payments,
phi_fixed_annual_payments,
pcomp_fixed_annual_payments,
txn_fixed_annual_payments,
base_direct_shopper_marketing,
phi_direct_shopper_marketing,
pcomp_direct_shopper_marketing,
txn_direct_shopper_marketing,
base_other_direct_payments,
phi_other_direct_payments,
pcomp_other_direct_payments,
txn_other_direct_payments,
base_pcos_std_ingredients,
phi_pcos_std_ingredients,
pcomp_pcos_std_ingredients,
txn_pcos_std_ingredients,
base_pcos_std_packaging,
phi_pcos_std_packaging,
pcomp_pcos_std_packaging,
txn_pcos_std_packaging,
base_pcos_std_labour,
phi_pcos_std_labour,
pcomp_pcos_std_labour,
txn_pcos_std_labour,
base_pcos_std_co_packing,
phi_pcos_std_co_packing,
pcomp_pcos_std_co_packing,
txn_pcos_std_co_packing,
base_pcos_std_bought_in,
phi_pcos_std_bought_in,
pcomp_pcos_std_bought_in,
txn_pcos_std_bought_in,
base_pcos_std_other,
phi_pcos_std_other,
pcomp_pcos_std_other,
txn_pcos_std_other,
base_pcos_var_ingredients,
phi_pcos_var_ingredients,
pcomp_pcos_var_ingredients,
txn_pcos_var_ingredients,
base_pcos_var_packaging,
phi_pcos_var_packaging,
pcomp_pcos_var_packaging,
txn_pcos_var_packaging,
base_pcos_var_labour,
phi_pcos_var_labour,
pcomp_pcos_var_labour,
txn_pcos_var_labour,
base_pcos_var_co_packing,
phi_pcos_var_co_packing,
pcomp_pcos_var_co_packing,
txn_pcos_var_co_packing,
base_pcos_var_bought_in,
phi_pcos_var_bought_in,
pcomp_pcos_var_bought_in,
txn_pcos_var_bought_in,
base_pcos_var_other,
phi_pcos_var_other,
pcomp_pcos_var_other,
txn_pcos_var_other,
base_indirect_shopper_marketing,
phi_indirect_shopper_marketing,
pcomp_indirect_shopper_marketing,
txn_indirect_shopper_marketing,
base_category,
phi_category,
pcomp_category,
txn_category,
base_other_indirect_payments,
phi_other_indirect_payments,
pcomp_other_indirect_payments,
txn_other_indirect_payments,
base_field_marketing,
phi_field_marketing,
pcomp_field_marketing,
txn_field_marketing,
base_other_trade,
phi_other_trade,
pcomp_other_trade,
txn_other_trade,
base_marketing_agency_fees,
phi_marketing_agency_fees,
pcomp_marketing_agency_fees,
txn_marketing_agency_fees,
base_research,
phi_research,
pcomp_research,
txn_research,
base_continuous_research,
phi_continuous_research,
pcomp_continuous_research,
txn_continuous_research,
base_market_research,
phi_market_research,
pcomp_market_research,
txn_market_research,
base_sponsorship,
phi_sponsorship,
pcomp_sponsorship,
txn_sponsorship,
base_sales_promotions,
phi_sales_promotions,
pcomp_sales_promotions,
txn_sales_promotions,
base_pack_artwork_design,
phi_pack_artwork_design,
pcomp_pack_artwork_design,
txn_pack_artwork_design,
base_pos_materials,
phi_pos_materials,
pcomp_pos_materials,
txn_pos_materials,
base_samples_issued,
phi_samples_issued,
pcomp_samples_issued,
txn_samples_issued,
base_pr,
phi_pr,
pcomp_pr,
txn_pr,
base_advertising_tv,
phi_advertising_tv,
pcomp_advertising_tv,
txn_advertising_tv,
base_tv_advertising_production,
phi_tv_advertising_production,
pcomp_tv_advertising_production,
txn_tv_advertising_production,
base_press_advertising_consumer,
phi_press_advertising_consumer,
pcomp_press_advertising_consumer,
txn_press_advertising_consumer,
base_press_advertising_production_consumer,
phi_press_advertising_production_consumer,
pcomp_press_advertising_production_consumer,
txn_press_advertising_production_consumer,
base_radio_time,
phi_radio_time,
pcomp_radio_time,
txn_radio_time,
base_radio_time_production,
phi_radio_time_production,
pcomp_radio_time_production,
txn_radio_time_production,
base_website_marketing,
phi_website_marketing,
pcomp_website_marketing,
txn_website_marketing,
base_poster_space,
phi_poster_space,
pcomp_poster_space,
txn_poster_space,
base_poster_production,
phi_poster_production,
pcomp_poster_production,
txn_poster_production,
base_digital_media,
phi_digital_media,
pcomp_digital_media,
txn_digital_media,
base_digital_media_production,
phi_digital_media_production,
pcomp_digital_media_production,
txn_digital_media_production,

 from int