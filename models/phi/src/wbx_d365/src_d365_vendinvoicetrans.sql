with d365_source as (
        select *
        from {{ source("D365", "vend_invoice_trans") }}  where _FIVETRAN_DELETED='FALSE' and upper(data_area_id) in {{env_var("DBT_D365_COMPANY_FILTER")}}
    ),

renamed as (
        
    select 
        'D365' as source,
        invoice_id as invoiceid,
        invoice_date as invoicedate,
        line_num as linenum,
        invent_trans_id as inventtransid,
        dest_country_region_id as destcountryregionid,
        item_id as itemid,
        null as externalitemid,
        name as name,
        tax_group as taxgroup,
        currency_code as currencycode,
        price_unit as priceunit,
        qty as qty,
        purch_price as purchprice,
        disc_percent as discpercent,
        disc_amount as discamount,
        line_amount as lineamount,
        tax_amount as taxamount,
        qty_physical as qtyphysical,
        part_delivery as partdelivery,
        invent_ref_id as inventrefid,
        purch_id as purchid,
        purch_unit as purchunit,
        purch_markup as purchmarkup,
        null as transactioncode,
        invent_ref_type as inventreftype,
        invent_ref_trans_id as inventreftransid,
        dest_state as deststate,
        null as taxwritecode,
        tax_autogenerated as taxautogenerated,
        tax_item_group as taxitemgroup,
        tax_1099_amount as tax1099amount,
        tax_1099_date as tax1099date,
        null as tax1099num,
        multi_ln_disc as multilndisc,
        multi_ln_percent as multilnpercent,
        line_disc as linedisc,
        line_percent as linepercent,
        orig_purch_id as origpurchid,
        null as transport,
        internal_invoice_id as internalinvoiceid,
        null as intercompanyinventtransid,
        null as numbersequencegroup,
        invent_dim_id as inventdimid,
        line_amount_tax as lineamounttax,
        null as port,
        null as statprocid,
        invent_date as inventdate,
        dest_county as destcounty,
        intrastat_dispatch_id as intrastatdispatchid,
        invent_qty as inventqty,
        null as tax1099state,
        tax_1099_state_amount as tax1099stateamount,
        settle_tax_1099_amount as settletax1099amount,
        settle_tax_1099_state_amount as settletax1099stateamount,
        line_amount_mst as lineamountmst,
        null as reversechargeapplies_uk,
        tax_1099_rec_id as tax1099recid,
        reason_table_ref as reasontableref,
        procurement_category as procurementcategory,
        null as itemcodeid,
        null as origstateid,
        null as origcountryregionid,
        weight as weight,
        default_dimension as defaultdimension,
        ledger_dimension as ledgerdimension,
        tax_1099_fields as tax1099fields,
        purchase_line_line_number as purchaselinelinenumber,
        source_document_line as sourcedocumentline,
        tax_withhold_item_group_heading_th as taxwithholditemgroupheading_th,
        line_type as linetype,
        description as description,
        delivery_name as deliveryname,
        delivery_postal_address as deliverypostaladdress,
        operation_type_mx as operationtype_mx,
        stocked_product as stockedproduct,
        ngpcodes_table_fr as ngpcodestable_fr,
        advance_application_id as advanceapplicationid,
        null as taxwithholdgroup_th,
        company_location_in as companylocation_in,
        customs_tariff_code_table_in as customstariffcodetable_in,
        excise_tariff_codes_in as excisetariffcodes_in,
        registration_postal_address_in as registrationpostaladdress_in,
        sales_tax_form_types_in as salestaxformtypes_in,
        vendor_location_in as vendorlocation_in,
        excise_type_in as excisetype_in,
        vatamount_in as vatamount_in,
        vatdeferred_in as vatdeferred_in,
        vatexpense_in as vatexpense_in,
        vatgoods_type_in as vatgoodstype_in,
        non_recoverable_percent_in as nonrecoverablepercent_in,
        null as tdsgroup_in,
        null as tcsgroup_in,
        gtaservice_category_in as gtaservicecategory_in,
        excise_record_type_in as exciserecordtype_in,
        maximum_retail_price_in as maximumretailprice_in,
        assessable_value_in as assessablevalue_in,
        credit_note_date_in as creditnotedate_in,
        tax_withhold_line_num_in as taxwithholdlinenum_in,
        null as taxwithholdvoucher_in,
        tax_withhold_base_cur_th as taxwithholdbasecur_th,
        intrastat_fulfillment_date_hu as intrastatfulfillmentdate_hu,
        excise_value_ru as excisevalue_ru,
        vatvalue_ru as vatvalue_ru,
        excise_amount_ru as exciseamount_ru,
        vatamount_ru as vatamount_ru,
        factured_qty_ru as facturedqty_ru,
        factured_fully_ru as facturedfully_ru,
        ref_return_invoice_trans_w as refreturninvoicetrans_w,
        statistic_value_lt as statisticvalue_lt,
        vatdocument_type_ru as vatdocumenttype_ru,
        line_amount_mst_w as lineamountmst_w,
        tax_amount_mst_w as taxamountmst_w,
        vatamount_mst_ru as vatamountmst_ru,
        excise_amount_mst_ru as exciseamountmst_ru,
        rbopackage_line_num as rbopackagelinenum,
        null as retailpackageid,
        agreement_line_psn as agreementline_psn,
        null as alcohollicenseseriesnum_ru,
        null as countryregionname_ru,
        dsa_in as dsa_in,
        null as invoicegtdid_ru,
        is_pwp as ispwp,
        null as markupcode_ru,
        pds_cwqty as pdscwqty,
        pds_cwqty_physical as pdscwqtyphysical,
        psarelease_amount as psareleaseamount,
        psaretainage_amount as psaretainageamount,
        purch_commitment_line_psn as purchcommitmentline_psn,
        ready_for_payment as readyforpayment,
        service_code_table_in as servicecodetable_in,
        vend_directive_psn as venddirective_psn,
        modifieddatetime as modifieddatetime,
        createddatetime as createddatetime,
        upper(data_area_id) as dataareaid,
        recversion as recversion,
        partition as partition,
        recid as recid,
        budget_reservation_line_psn as budgetreservationline_psn

from d365_source

)

select * from renamed 


