with d365_source as (
        select *
        from {{ source("D365", "cust_invoice_trans") }}
        where trim(upper(data_area_id)) in {{env_var("DBT_D365_COMPANY_FILTER")}} and _FIVETRAN_DELETED='FALSE' 
    ),
renamed as (

   
    select 
        'D365' as source,
        invoice_id as invoiceid,
        invoice_date as invoicedate,
        line_num as linenum,
        invent_trans_id as inventtransid,
        invent_ref_id as inventrefid,
        item_id as itemid,
        null as externalitemid,
        name as name,
        tax_group as taxgroup,
        currency_code as currencycode,
        price_unit as priceunit,
        qty as qty,
        sales_price as salesprice,
        disc_percent as discpercent,
        disc_amount as discamount,
        line_amount as lineamount,
        null as salesgroup,
        qty_physical as qtyphysical,
        part_delivery as partdelivery,
        remain as remain,
        sales_id as salesid,
        sales_unit as salesunit,
        sales_markup as salesmarkup,
        commiss_calc as commisscalc,
        commiss_amount_cur as commissamountcur,
        null as transactioncode,
        delivery_type as deliverytype,
        null as countryregionofshipment,
        null as itemcodeid,
        tax_autogenerated as taxautogenerated,
        tax_item_group as taxitemgroup,
        tax_amount as taxamount,
        null as taxwritecode,
        multi_ln_disc as multilndisc,
        multi_ln_percent as multilnpercent,
        line_disc as linedisc,
        line_percent as linepercent,
        orig_sales_id as origsalesid,
        line_header as lineheader,
        null as transport,
        invent_dim_id as inventdimid,
        null as origcountryregionid,
        null as numbersequencegroup,
        null as statprocid,
        dlv_date as dlvdate,
        line_amount_tax as lineamounttax,
        null as port,
        null as assetid,
        customer_line_num as customerlinenum,
        null as assetbookid,
        line_amount_mst as lineamountmst,
        tax_amount_mst as taxamountmst,
        line_amount_tax_mst as lineamounttaxmst,
        commiss_amount_mst as commissamountmst,
        sum_line_disc as sumlinedisc,
        sum_line_disc_mst as sumlinediscmst,
        null as intercompanyinventtransid,
        olapcost_value as olapcostvalue,
        null as einvoiceaccountcode,
        return_disposition_code_id as returndispositioncodeid,
        stat_line_amount_mst as statlineamountmst,
        null as intrastatdispatchid,
        invent_qty as inventqty,
        null as origstate,
        invent_ref_type as inventreftype,
        invent_ref_trans_id as inventreftransid,
        weight as weight,
        return_arrival_date as returnarrivaldate,
        return_closed_date as returncloseddate,
        null as reversechargeapplies_uk,
        reason_ref_rec_id as reasonrefrecid,
        remain_before as remainbefore,
        sales_category as salescategory,
        cust_invoice_line_id_ref as custinvoicelineidref,
        source_document_line  as sourcedocumentline,
        delivery_postal_address  as deliverypostaladdress,
        ledger_dimension  as ledgerdimension,
        default_dimension  as defaultdimension,
        tax_withhold_item_group_heading_th as taxwithholditemgroupheading_th,
        stocked_product as stockedproduct,
        reversed_rec_id as reversedrecid,
        ngpcodes_table_fr as ngpcodestable_fr,
        parent_rec_id  as parentrecid,
        null as taxwithholdgroup_th,
        intrastat_fulfillment_date_hu as intrastatfulfillmentdate_hu,
        null as billingcode,
        mcrdelivery_name as mcrdeliveryname,
        mcrdlv_mode as mcrdlvmode,
        pds_cwqty as pdscwqty,
        pds_cwqty_physical as pdscwqtyphysical,
        pds_cwremain as pdscwremain,
        retail_category as retailcategory,
        modifieddatetime as modifieddatetime,
        createddatetime as createddatetime,
        null as del_createdtime,
        createdby as createdby,
        upper(data_area_id) as dataareaid,
        recversion as recversion,
        partition as partition,
        recid as recid,
        null as orderlinereference_no
    from d365_source

)

select * from renamed

