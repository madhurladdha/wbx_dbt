with d365source as (
    select *
    from {{ source("D365S", "custinvoicetrans") }}
    where
        trim(upper(dataareaid)) in {{ env_var("DBT_D365_COMPANY_FILTER") }}
        and _fivetran_deleted = 'FALSE'
),

renamed as (


    select
        'D365S' as source,
        invoiceid as invoiceid,
        cast(invoicedate as TIMESTAMP_NTZ) as invoicedate,
        linenum as linenum,
        inventtransid as inventtransid,
        inventrefid as inventrefid,
        itemid as itemid,
        null as externalitemid,
        name as name,
        taxgroup as taxgroup,
        currencycode as currencycode,
        priceunit as priceunit,
        qty as qty,
        salesprice as salesprice,
        discpercent as discpercent,
        discamount as discamount,
        lineamount as lineamount,
        null as salesgroup,
        qtyphysical as qtyphysical,
        partdelivery as partdelivery,
        remain as remain,
        salesid as salesid,
        salesunit as salesunit,
        salesmarkup as salesmarkup,
        commisscalc as commisscalc,
        commissamountcur as commissamountcur,
        null as transactioncode,
        deliverytype as deliverytype,
        null as countryregionofshipment,
        null as itemcodeid,
        taxautogenerated as taxautogenerated,
        taxitemgroup as taxitemgroup,
        taxamount as taxamount,
        null as taxwritecode,
        multilndisc as multilndisc,
        multilnpercent as multilnpercent,
        linedisc as linedisc,
        linepercent as linepercent,
        origsalesid as origsalesid,
        lineheader as lineheader,
        null as transport,
        inventdimid as inventdimid,
        null as origcountryregionid,
        null as numbersequencegroup,
        null as statprocid,
        cast(dlvdate as TIMESTAMP_NTZ) as dlvdate,
        lineamounttax as lineamounttax,
        null as port,
        null as assetid,
        customerlinenum as customerlinenum,
        null as assetbookid,
        lineamountmst as lineamountmst,
        taxamountmst as taxamountmst,
        lineamounttaxmst as lineamounttaxmst,
        commissamountmst as commissamountmst,
        sumlinedisc as sumlinedisc,
        sumlinediscmst as sumlinediscmst,
        null as intercompanyinventtransid,
        olapcostvalue as olapcostvalue,
        null as einvoiceaccountcode,
        returndispositioncodeid as returndispositioncodeid,
        statlineamountmst as statlineamountmst,
        null as intrastatdispatchid,
        inventqty as inventqty,
        null as origstate,
        inventreftype as inventreftype,
        inventreftransid as inventreftransid,
        weight as weight,
        cast(returnarrivaldate as TIMESTAMP_NTZ) as returnarrivaldate,
        cast(returncloseddate as TIMESTAMP_NTZ) as returncloseddate,
        null as reversechargeapplies_uk,
        reasonrefrecid as reasonrefrecid,
        remainbefore as remainbefore,
        salescategory as salescategory,
        custinvoicelineidref as custinvoicelineidref,
        sourcedocumentline as sourcedocumentline,
        deliverypostaladdress as deliverypostaladdress,
        ledgerdimension as ledgerdimension,
        defaultdimension as defaultdimension,
        taxwithholditemgroupheading_th as taxwithholditemgroupheading_th,
        stockedproduct as stockedproduct,
        reversedrecid as reversedrecid,
        ngpcodestable_fr as ngpcodestable_fr,
        parentrecid as parentrecid,
        null as taxwithholdgroup_th,
        cast(intrastatfulfillmentdate_hu as TIMESTAMP_NTZ)
            as intrastatfulfillmentdate_hu,
        null as billingcode,
        mcrdeliveryname as mcrdeliveryname,
        mcrdlvmode as mcrdlvmode,
        pdscwqty as pdscwqty,
        pdscwqtyphysical as pdscwqtyphysical,
        pdscwremain as pdscwremain,
        retailcategory as retailcategory,
        cast(modifieddatetime as TIMESTAMP_NTZ) as modifieddatetime,
        cast(createddatetime as TIMESTAMP_NTZ) as createddatetime,
        null as del_createdtime,
        createdby as createdby,
        upper(dataareaid) as dataareaid,
        recversion as recversion,
        partition as partition,
        recid as recid,
        null as orderlinereference_no
    from d365source

)

select * from renamed

