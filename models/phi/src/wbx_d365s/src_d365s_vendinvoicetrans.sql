with d365_source as (
    select *
    from {{ source("D365S", "vendinvoicetrans") }}
    where
        _fivetran_deleted = 'FALSE'
        and upper(dataareaid) in {{ env_var("DBT_D365_COMPANY_FILTER") }}
),

renamed as (

    select
        'D365S' as source,
        invoiceid as invoiceid,
        cast(invoicedate as TIMESTAMP_NTZ) as invoicedate,
        linenum as linenum,
        inventtransid as inventtransid,
        destcountryregionid as destcountryregionid,
        itemid as itemid,
        null as externalitemid,
        name as name,
        taxgroup as taxgroup,
        currencycode as currencycode,
        priceunit as priceunit,
        qty as qty,
        purchprice as purchprice,
        discpercent as discpercent,
        discamount as discamount,
        lineamount as lineamount,
        taxamount as taxamount,
        qtyphysical as qtyphysical,
        partdelivery as partdelivery,
        inventrefid as inventrefid,
        purchid as purchid,
        purchunit as purchunit,
        purchmarkup as purchmarkup,
        null as transactioncode,
        inventreftype as inventreftype,
        inventreftransid as inventreftransid,
        deststate as deststate,
        null as taxwritecode,
        taxautogenerated as taxautogenerated,
        taxitemgroup as taxitemgroup,
        tax_1099_amount as tax1099amount,
        cast(tax_1099_date as TIMESTAMP_NTZ) as tax1099date,
        null as tax1099num,
        multilndisc as multilndisc,
        multilnpercent as multilnpercent,
        linedisc as linedisc,
        linepercent as linepercent,
        origpurchid as origpurchid,
        null as transport,
        internalinvoiceid as internalinvoiceid,
        null as intercompanyinventtransid,
        null as numbersequencegroup,
        inventdimid as inventdimid,
        lineamounttax as lineamounttax,
        null as port,
        null as statprocid,
        cast(inventdate as TIMESTAMP_NTZ) as inventdate,
        destcounty as destcounty,
        intrastatdispatchid as intrastatdispatchid,
        inventqty as inventqty,
        null as tax1099state,
        tax_1099_stateamount as tax1099stateamount,
        settletax_1099_amount as settletax1099amount,
        settletax_1099_stateamount as settletax1099stateamount,
        lineamountmst as lineamountmst,
        null as reversechargeapplies_uk,
        tax_1099_recid as tax1099recid,
        reasontableref as reasontableref,
        procurementcategory as procurementcategory,
        null as itemcodeid,
        null as origstateid,
        null as origcountryregionid,
        weight as weight,
        defaultdimension as defaultdimension,
        ledgerdimension as ledgerdimension,
        tax_1099_fields as tax1099fields,
        purchaselinelinenumber as purchaselinelinenumber,
        sourcedocumentline as sourcedocumentline,
        taxwithholditemgroupheading_th as taxwithholditemgroupheading_th,
        linetype as linetype,
        description as description,
        deliveryname as deliveryname,
        deliverypostaladdress as deliverypostaladdress,
        operationtype_mx as operationtype_mx,
        stockedproduct as stockedproduct,
        ngpcodestable_fr as ngpcodestable_fr,
        advanceapplicationid as advanceapplicationid,
        null as taxwithholdgroup_th,
        companylocation_in as companylocation_in,
        customstariffcodetable_in as customstariffcodetable_in,
        excisetariffcodes_in as excisetariffcodes_in,
        registrationpostaladdress_in as registrationpostaladdress_in,
        salestaxformtypes_in as salestaxformtypes_in,
        vendorlocation_in as vendorlocation_in,
        excisetype_in as excisetype_in,
        vatamount_in as vatamount_in,
        vatdeferred_in as vatdeferred_in,
        vatexpense_in as vatexpense_in,
        vatgoodstype_in as vatgoodstype_in,
        nonrecoverablepercent_in as nonrecoverablepercent_in,
        null as tdsgroup_in,
        null as tcsgroup_in,
        gtaservicecategory_in as gtaservicecategory_in,
        exciserecordtype_in as exciserecordtype_in,
        maximumretailprice_in as maximumretailprice_in,
        assessablevalue_in as assessablevalue_in,
        cast(creditnotedate_in as TIMESTAMP_NTZ) as creditnotedate_in,
        taxwithholdlinenum_in as taxwithholdlinenum_in,
        null as taxwithholdvoucher_in,
        taxwithholdbasecur_th as taxwithholdbasecur_th,
        cast(intrastatfulfillmentdate_hu as TIMESTAMP_NTZ)
            as intrastatfulfillmentdate_hu,
        excisevalue_ru as excisevalue_ru,
        vatvalue_ru as vatvalue_ru,
        exciseamount_ru as exciseamount_ru,
        vatamount_ru as vatamount_ru,
        facturedqty_ru as facturedqty_ru,
        facturedfully_ru as facturedfully_ru,
        refreturninvoicetrans_w as refreturninvoicetrans_w,
        statisticvalue_lt as statisticvalue_lt,
        vatdocumenttype_ru as vatdocumenttype_ru,
        lineamountmst_w as lineamountmst_w,
        taxamountmst_w as taxamountmst_w,
        vatamountmst_ru as vatamountmst_ru,
        exciseamountmst_ru as exciseamountmst_ru,
        rbopackagelinenum as rbopackagelinenum,
        null as retailpackageid,
        agreementline_psn as agreementline_psn,
        null as alcohollicenseseriesnum_ru,
        null as countryregionname_ru,
        dsa_in as dsa_in,
        null as invoicegtdid_ru,
        ispwp as ispwp,
        null as markupcode_ru,
        pdscwqty as pdscwqty,
        pdscwqtyphysical as pdscwqtyphysical,
        psareleaseamount as psareleaseamount,
        psaretainageamount as psaretainageamount,
        purchcommitmentline_psn as purchcommitmentline_psn,
        readyforpayment as readyforpayment,
        servicecodetable_in as servicecodetable_in,
        venddirective_psn as venddirective_psn,
        cast(modifieddatetime as TIMESTAMP_NTZ) as modifieddatetime,
        cast(createddatetime as TIMESTAMP_NTZ) as createddatetime,
        upper(dataareaid) as dataareaid,
        recversion as recversion,
        partition as partition,
        recid as recid,
        budgetreservationline_psn as budgetreservationline_psn

    from d365_source

)

select * from renamed


