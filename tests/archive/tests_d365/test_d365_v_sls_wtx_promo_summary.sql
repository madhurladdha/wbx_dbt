{{ config( 
  enabled=false, 
  snowflake_warehouse=env_var("DBT_WBX_SF_WH"),
  severity = 'warn', 
  warn_if = '>0' ,
  tags=["sales","promo","sales_promo_summary"]

) }} 

--All fields are included in test. PROMO_PHASE_LENGTH has .000 in iics but not in dbt. hence compiled this model and used trunc in comparision

with a as (

    
select
   "SOURCE_SYSTEM"           ,      
    "SOURCE_ITEM_IDENTIFIER"           ,      
    "PLAN_SOURCE_CUSTOMER_CODE"           ,      
    "CALENDAR_DATE"           ,      
    "SNAPSHOT_DATE"           ,      
    "FROZEN_FORECAST"           ,      
    "FROZEN_FORECAST_DELINEATION_DATE"           ,      
    "SOURCE_CONTENT_FILTER"           ,      
    "ISPROMOSKU"           ,      
    "ISCANNIBSKU"           ,      
    round(SI_B_VOL_CSE),
	round(SI_A_VOL_CSE),
	round(SI_T_VOL_CSE),
	round(SI_M_VOL_CSE),
	round(SI_I_VOL_CSE),
	round(SI_B_VOL_KG),
	round(SI_A_VOL_KG),
	round(SI_T_VOL_KG) as SI_T_VOL_KG,
	round(SI_M_VOL_KG),
	round(ACTUALS_TOT_VOL_KG),
	round(BASE_TOT_VOL_KG),
	round(FORECAST_TOT_VOL_KG),
	round(SI_I_VOL_KG),
	round(ACTUALS_AP_GROSS_SALES_VALUE),
	round(ACTUALS_AP_RANGE_SUPPORT_ALLOWANCE),
	round(ACTUALS_AP_EVERYDAY_LOW_PRICES),
	round(ACTUALS_AP_PERMANENT_DISC),
	round(ACTUALS_AP_OFF_INVOICE_DISC),
	round(ACTUALS_AP_INVOICED_SALES_VALUE),
	round(ACTUALS_AP_EARLY_SETTLEMENT_DISC),
	round(ACTUALS_AP_GROWTH_INCENTIVES),
	round(ACTUALS_AP_NET_SALES_VALUE),
	round(ACTUALS_AP_RETRO),
	round(ACTUALS_AP_AVP_DISC),
	round(ACTUALS_AP_VARIABLE_TRADE),
	round(ACTUALS_AP_PROMO_FIXED_FUNDING),
	round(ACTUALS_AP_RANGE_SUPPORT_INCENTIVES),
	round(ACTUALS_AP_NET_NET_SALES_VALUE),
	round(ACTUALS_AP_DIRECT_SHOPPER_MARKETING),
	round(ACTUALS_AP_OTHER_DIRECT_PAYMENTS),
	round(ACTUALS_AP_INDIRECT_SHOPPER_MARKETING),
	round(ACTUALS_AP_OTHER_INDIRECT_PAYMENTS),
	round(ACTUALS_AP_FIXED_TRADE_CUST_INVOICED),
	round(ACTUALS_AP_TOTAL_TRADE_CUST_INVOICED),
	round(ACTUALS_AP_FIXED_TRADE_NON_CUST_INVOICED),
	round(ACTUALS_AP_TOTAL_TRADE),
	round(ACTUALS_AP_NET_REALISABLE_REVENUE),
	round(ACTUALS_AP_TOT_PRIME_COST_STANDARD),
	round(ACTUALS_AP_GROSS_MARGIN_STANDARD),
	round(ACTUALS_AP_GCAT_STANDARD),
	round(ACTUALS_RETAIL_TOT_VOL_KG),
	round(ACTUALS_AP_RETAIL_REVENUE_MRRSP),
	round(ACTUALS_AP_RETAIL_REVENUE_RSP),
	round(ACTUALS_AP_RETAIL_REVENUE_NET),
	round(ACTUALS_AP_RETAIL_COST_OF_SALES),
	round(ACTUALS_AP_RETAIL_RETAILER_RETRO_FUNDING),
	round(ACTUALS_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING),
	round(ACTUALS_AP_RETAIL_PROMO_FIXED_SPEND),
	round(ACTUALS_AP_RETAIL_TOTAL_SPEND),
	round(ACTUALS_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING),
	round(ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_MRRSP),
	round(ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_RSP),
	round(BASE_AP_GROSS_SALES_VALUE),
	round(BASE_AP_RANGE_SUPPORT_ALLOWANCE),
	round(BASE_AP_EVERYDAY_LOW_PRICES),
	round(BASE_AP_PERMANENT_DISC),
	round(BASE_AP_OFF_INVOICE_DISC),
	round(BASE_AP_INVOICED_SALES_VALUE),
	round(BASE_AP_EARLY_SETTLEMENT_DISC),
	round(BASE_AP_GROWTH_INCENTIVES),
	round(BASE_AP_NET_SALES_VALUE),
	round(BASE_AP_RETRO),
	round(BASE_AP_AVP_DISC),
	round(BASE_AP_VARIABLE_TRADE),
	round(BASE_AP_PROMO_FIXED_FUNDING),
	round(BASE_AP_RANGE_SUPPORT_INCENTIVES),
	round(BASE_AP_NET_NET_SALES_VALUE),
	round(BASE_AP_DIRECT_SHOPPER_MARKETING),
	round(BASE_AP_OTHER_DIRECT_PAYMENTS),
	round(BASE_AP_INDIRECT_SHOPPER_MARKETING),
	round(BASE_AP_OTHER_INDIRECT_PAYMENTS),
	round(BASE_AP_FIXED_TRADE_CUST_INVOICED),
	round(BASE_AP_TOTAL_TRADE_CUST_INVOICED),
	round(BASE_AP_FIXED_TRADE_NON_CUST_INVOICED),
	round(BASE_AP_TOTAL_TRADE),
	round(BASE_AP_NET_REALISABLE_REVENUE),
	round(BASE_AP_TOT_PRIME_COST_STANDARD),
	round(BASE_AP_GROSS_MARGIN_STANDARD),
	round(BASE_AP_GCAT_STANDARD),
	round(BASE_RETAIL_TOT_VOL_KG),
	round(BASE_AP_RETAIL_REVENUE_MRRSP),
	round(BASE_AP_RETAIL_REVENUE_RSP),
	round(BASE_AP_RETAIL_REVENUE_NET),
	round(BASE_AP_RETAIL_COST_OF_SALES),
	round(BASE_AP_RETAIL_RETAILER_RETRO_FUNDING),
	round(BASE_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING),
	round(BASE_AP_RETAIL_PROMO_FIXED_SPEND),
	round(BASE_AP_RETAIL_TOTAL_SPEND),
	round(BASE_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING),
	round(BASE_AP_RETAIL_REVENUE_NET_EXCL_MRRSP),
	round(BASE_AP_RETAIL_REVENUE_NET_EXCL_RSP),
	round(FORECAST_AP_GROSS_SALES_VALUE),
	round(FORECAST_AP_RANGE_SUPPORT_ALLOWANCE),
	round(FORECAST_AP_EVERYDAY_LOW_PRICES),
	round(FORECAST_AP_PERMANENT_DISC),
	round(FORECAST_AP_OFF_INVOICE_DISC),
	round(FORECAST_AP_INVOICED_SALES_VALUE),
	round(FORECAST_AP_EARLY_SETTLEMENT_DISC),
	round(FORECAST_AP_GROWTH_INCENTIVES),
	round(FORECAST_AP_NET_SALES_VALUE),
	round(FORECAST_AP_RETRO),
	round(FORECAST_AP_AVP_DISC),
	round(FORECAST_AP_VARIABLE_TRADE),
	round(FORECAST_AP_PROMO_FIXED_FUNDING),
	round(FORECAST_AP_RANGE_SUPPORT_INCENTIVES),
	round(FORECAST_AP_NET_NET_SALES_VALUE),
	round(FORECAST_AP_DIRECT_SHOPPER_MARKETING),
	round(FORECAST_AP_OTHER_DIRECT_PAYMENTS),
	round(FORECAST_AP_INDIRECT_SHOPPER_MARKETING),
	round(FORECAST_AP_OTHER_INDIRECT_PAYMENTS),
	round(FORECAST_AP_FIXED_TRADE_CUST_INVOICED),
	round(FORECAST_AP_TOTAL_TRADE_CUST_INVOICED),
	round(FORECAST_AP_FIXED_TRADE_NON_CUST_INVOICED),
	round(FORECAST_AP_TOTAL_TRADE),
	round(FORECAST_AP_TOTAL_TRADE_GBP),
	round(FORECAST_AP_NET_REALISABLE_REVENUE),
	round(FORECAST_AP_TOT_PRIME_COST_STANDARD),
	round(FORECAST_AP_GROSS_MARGIN_STANDARD),
	round(FORECAST_AP_GCAT_STANDARD),
	round(FORECAST_RETAIL_TOT_VOL_KG),
	round(FORECAST_AP_RETAIL_REVENUE_MRRSP),
	round(FORECAST_AP_RETAIL_REVENUE_RSP),
	round(FORECAST_AP_RETAIL_REVENUE_NET),
	round(FORECAST_AP_RETAIL_COST_OF_SALES),
	round(FORECAST_AP_RETAIL_RETAILER_RETRO_FUNDING),
	round(FORECAST_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING),
	round(FORECAST_AP_RETAIL_PROMO_FIXED_SPEND),
	round(FORECAST_AP_RETAIL_TOTAL_SPEND),
	round(FORECAST_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING),
	round(FORECAST_AP_RETAIL_REVENUE_NET_EXCL_MRRSP),
	round(FORECAST_AP_RETAIL_REVENUE_NET_EXCL_RSP),
	round(ACTUALS_TOT_VOL_CA),
	--round(ACTUALS_TOT_VOL_UL),
	round(BASE_TOT_VOL_CA),
	round(BASE_TOT_VOL_UL),
	--round(FORECAST_TOT_VOL_CA),
	round(FORECAST_TOT_VOL_UL),
	round(PRM_ACTUALS_TOT_VOL_CU),
	round(PRM_BASE_TOT_VOL_CU),
	round(PRM_FORECAST_TOT_VOL_CU),
	round(PRM_SI_B_VOL_CU),
	round(PRM_SI_A_VOL_CU),
	round(PRM_SI_T_VOL_CU),
	round(PRM_SI_M_VOL_CU),
	round(PRM_SI_I_VOL_CU),
    PRM_ACTUALS_TOT_VOL_PK,
	PRM_BASE_TOT_VOL_PK,
	PRM_FORECAST_TOT_VOL_PK,
	PRM_SI_B_VOL_PK,
	PRM_SI_A_VOL_PK,
	PRM_SI_T_VOL_PK,
	PRM_SI_M_VOL_PK,
	PRM_SI_I_VOL_PK,
    "PROMO_ID"           ,      
    "PROMO_CODE"           ,      
    "PROMO_DESC"           ,      
    "PROMO_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DISCOUNT"           ,      
    "PROMO_SUB_TACTIC_ISACTIVE"           ,      
    "PROMO_STAT_DESC"           ,      
    "PROMO_PHASE_DESC"           ,      
    trunc("PROMO_PHASE_LENGTH") PROMO_PHASE_LENGTH           ,      
    "PROMO_PHASE_EFFECT_DESC"           ,      
    "PROMO_PHASE_TYPE_DESC"           ,      
    "PROMO_PHASE_TYPE_UNIT"           ,      
    "AUTHORIZED_USER_NAME"           ,      
    "BUY_IN_START_DT"           ,      
    "BUY_IN_END_DT"           ,      
    "IN_STORE_START_DT"           ,      
    "IN_STORE_END_DT"           ,      
    "PERFORMANCE_START_DT"           ,      
    "PERFORMANCE_END_DT"           ,      
    "FEATURE"           ,      
    "FEATURE_DESC"           ,      
    "PROMO_MECHANIC_NAME"           ,      
    "MARKET"           ,      
    "SUBMARKET"           ,      
    "TRADE_CLASS"           ,      
    "TRADE_GROUP"           ,      
    "TRADE_TYPE"           ,      
    "TRADE_SECTOR"           ,      
    "DESCRIPTION"           ,      
    "ITEM_TYPE"           ,      
    "BRANDING_DESC"           ,      
    "PRODUCT_CLASS_DESC"           ,      
    "SUB_PRODUCT_DESC"           ,      
    "STRATEGIC_DESC"           ,      
    "POWER_BRAND_DESC"           ,      
    "MANUFACTURING_GROUP_DESC"           ,      
    "CATEGORY_DESC"           ,      
    "PACK_SIZE_DESC"           ,      
    "SUB_CATEGORY_DESC"           ,      
    "PROMO_TYPE_DESC"           ,      
    "REPORT_FISCAL_YEAR"           ,      
    "REPORT_FISCAL_YEAR_PERIOD_NO"           ,      
    "FISCAL_YEAR_BEGIN_DT"           ,      
    "FISCAL_YEAR_END_DT"           ,      
    "PLANNING_WEEK_CODE"           ,      
    "PLANNING_WEEK_START_DT"           ,      
    "PLANNING_WEEK_END_DT"           ,      
    "PLANNING_WEEK_NO"           ,      
    "PLANNING_MONTH_CODE"           ,      
    "PLANNING_MONTH_START_DT"           ,      
    "PLANNING_MONTH_END_DT"           ,      
    "PLANNING_QUARTER_NO"           ,      
    "PLANNING_QUARTER_START_DT"           ,      
    "PLANNING_QUARTER_END_DT"           ,      
    "PLANNING_YEAR_NO"           ,      
    "PLANNING_YEAR_START_DT"           ,      
    "PLANNING_YEAR_END_DT"           ,      
    "BILL_NAME"      
  

from wbx_prod.r_ei_sysadm.v_sls_wtx_promo_summary


),

b as (

    
select
      "SOURCE_SYSTEM"           ,      
    "SOURCE_ITEM_IDENTIFIER"           ,      
    "PLAN_SOURCE_CUSTOMER_CODE"           ,      
    "CALENDAR_DATE"           ,      
    "SNAPSHOT_DATE"           ,      
    "FROZEN_FORECAST"           ,      
    "FROZEN_FORECAST_DELINEATION_DATE"           ,      
    "SOURCE_CONTENT_FILTER"           ,      
    "ISPROMOSKU"           ,      
    "ISCANNIBSKU"           ,      
    round(SI_B_VOL_CSE),
	round(SI_A_VOL_CSE),
	round(SI_T_VOL_CSE),
	round(SI_M_VOL_CSE),
	round(SI_I_VOL_CSE),
	round(SI_B_VOL_KG),
	round(SI_A_VOL_KG),
	round(SI_T_VOL_KG) as SI_T_VOL_KG,
	round(SI_M_VOL_KG),
	round(ACTUALS_TOT_VOL_KG),
	round(BASE_TOT_VOL_KG),
	round(FORECAST_TOT_VOL_KG),
	round(SI_I_VOL_KG),
	round(ACTUALS_AP_GROSS_SALES_VALUE),
	round(ACTUALS_AP_RANGE_SUPPORT_ALLOWANCE),
	round(ACTUALS_AP_EVERYDAY_LOW_PRICES),
	round(ACTUALS_AP_PERMANENT_DISC),
	round(ACTUALS_AP_OFF_INVOICE_DISC),
	round(ACTUALS_AP_INVOICED_SALES_VALUE),
	round(ACTUALS_AP_EARLY_SETTLEMENT_DISC),
	round(ACTUALS_AP_GROWTH_INCENTIVES),
	round(ACTUALS_AP_NET_SALES_VALUE),
	round(ACTUALS_AP_RETRO),
	round(ACTUALS_AP_AVP_DISC),
	round(ACTUALS_AP_VARIABLE_TRADE),
	round(ACTUALS_AP_PROMO_FIXED_FUNDING),
	round(ACTUALS_AP_RANGE_SUPPORT_INCENTIVES),
	round(ACTUALS_AP_NET_NET_SALES_VALUE),
	round(ACTUALS_AP_DIRECT_SHOPPER_MARKETING),
	round(ACTUALS_AP_OTHER_DIRECT_PAYMENTS),
	round(ACTUALS_AP_INDIRECT_SHOPPER_MARKETING),
	round(ACTUALS_AP_OTHER_INDIRECT_PAYMENTS),
	round(ACTUALS_AP_FIXED_TRADE_CUST_INVOICED),
	round(ACTUALS_AP_TOTAL_TRADE_CUST_INVOICED),
	round(ACTUALS_AP_FIXED_TRADE_NON_CUST_INVOICED),
	round(ACTUALS_AP_TOTAL_TRADE),
	round(ACTUALS_AP_NET_REALISABLE_REVENUE),
	round(ACTUALS_AP_TOT_PRIME_COST_STANDARD),
	round(ACTUALS_AP_GROSS_MARGIN_STANDARD),
	round(ACTUALS_AP_GCAT_STANDARD),
	round(ACTUALS_RETAIL_TOT_VOL_KG),
	round(ACTUALS_AP_RETAIL_REVENUE_MRRSP),
	round(ACTUALS_AP_RETAIL_REVENUE_RSP),
	round(ACTUALS_AP_RETAIL_REVENUE_NET),
	round(ACTUALS_AP_RETAIL_COST_OF_SALES),
	round(ACTUALS_AP_RETAIL_RETAILER_RETRO_FUNDING),
	round(ACTUALS_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING),
	round(ACTUALS_AP_RETAIL_PROMO_FIXED_SPEND),
	round(ACTUALS_AP_RETAIL_TOTAL_SPEND),
	round(ACTUALS_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING),
	round(ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_MRRSP),
	round(ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_RSP),
	round(BASE_AP_GROSS_SALES_VALUE),
	round(BASE_AP_RANGE_SUPPORT_ALLOWANCE),
	round(BASE_AP_EVERYDAY_LOW_PRICES),
	round(BASE_AP_PERMANENT_DISC),
	round(BASE_AP_OFF_INVOICE_DISC),
	round(BASE_AP_INVOICED_SALES_VALUE),
	round(BASE_AP_EARLY_SETTLEMENT_DISC),
	round(BASE_AP_GROWTH_INCENTIVES),
	round(BASE_AP_NET_SALES_VALUE),
	round(BASE_AP_RETRO),
	round(BASE_AP_AVP_DISC),
	round(BASE_AP_VARIABLE_TRADE),
	round(BASE_AP_PROMO_FIXED_FUNDING),
	round(BASE_AP_RANGE_SUPPORT_INCENTIVES),
	round(BASE_AP_NET_NET_SALES_VALUE),
	round(BASE_AP_DIRECT_SHOPPER_MARKETING),
	round(BASE_AP_OTHER_DIRECT_PAYMENTS),
	round(BASE_AP_INDIRECT_SHOPPER_MARKETING),
	round(BASE_AP_OTHER_INDIRECT_PAYMENTS),
	round(BASE_AP_FIXED_TRADE_CUST_INVOICED),
	round(BASE_AP_TOTAL_TRADE_CUST_INVOICED),
	round(BASE_AP_FIXED_TRADE_NON_CUST_INVOICED),
	round(BASE_AP_TOTAL_TRADE),
	round(BASE_AP_NET_REALISABLE_REVENUE),
	round(BASE_AP_TOT_PRIME_COST_STANDARD),
	round(BASE_AP_GROSS_MARGIN_STANDARD),
	round(BASE_AP_GCAT_STANDARD),
	round(BASE_RETAIL_TOT_VOL_KG),
	round(BASE_AP_RETAIL_REVENUE_MRRSP),
	round(BASE_AP_RETAIL_REVENUE_RSP),
	round(BASE_AP_RETAIL_REVENUE_NET),
	round(BASE_AP_RETAIL_COST_OF_SALES),
	round(BASE_AP_RETAIL_RETAILER_RETRO_FUNDING),
	round(BASE_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING),
	round(BASE_AP_RETAIL_PROMO_FIXED_SPEND),
	round(BASE_AP_RETAIL_TOTAL_SPEND),
	round(BASE_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING),
	round(BASE_AP_RETAIL_REVENUE_NET_EXCL_MRRSP),
	round(BASE_AP_RETAIL_REVENUE_NET_EXCL_RSP),
	round(FORECAST_AP_GROSS_SALES_VALUE),
	round(FORECAST_AP_RANGE_SUPPORT_ALLOWANCE),
	round(FORECAST_AP_EVERYDAY_LOW_PRICES),
	round(FORECAST_AP_PERMANENT_DISC),
	round(FORECAST_AP_OFF_INVOICE_DISC),
	round(FORECAST_AP_INVOICED_SALES_VALUE),
	round(FORECAST_AP_EARLY_SETTLEMENT_DISC),
	round(FORECAST_AP_GROWTH_INCENTIVES),
	round(FORECAST_AP_NET_SALES_VALUE),
	round(FORECAST_AP_RETRO),
	round(FORECAST_AP_AVP_DISC),
	round(FORECAST_AP_VARIABLE_TRADE),
	round(FORECAST_AP_PROMO_FIXED_FUNDING),
	round(FORECAST_AP_RANGE_SUPPORT_INCENTIVES),
	round(FORECAST_AP_NET_NET_SALES_VALUE),
	round(FORECAST_AP_DIRECT_SHOPPER_MARKETING),
	round(FORECAST_AP_OTHER_DIRECT_PAYMENTS),
	round(FORECAST_AP_INDIRECT_SHOPPER_MARKETING),
	round(FORECAST_AP_OTHER_INDIRECT_PAYMENTS),
	round(FORECAST_AP_FIXED_TRADE_CUST_INVOICED),
	round(FORECAST_AP_TOTAL_TRADE_CUST_INVOICED),
	round(FORECAST_AP_FIXED_TRADE_NON_CUST_INVOICED),
	round(FORECAST_AP_TOTAL_TRADE),
	round(FORECAST_AP_TOTAL_TRADE_GBP),
	round(FORECAST_AP_NET_REALISABLE_REVENUE),
	round(FORECAST_AP_TOT_PRIME_COST_STANDARD),
	round(FORECAST_AP_GROSS_MARGIN_STANDARD),
	round(FORECAST_AP_GCAT_STANDARD),
	round(FORECAST_RETAIL_TOT_VOL_KG),
	round(FORECAST_AP_RETAIL_REVENUE_MRRSP),
	round(FORECAST_AP_RETAIL_REVENUE_RSP),
	round(FORECAST_AP_RETAIL_REVENUE_NET),
	round(FORECAST_AP_RETAIL_COST_OF_SALES),
	round(FORECAST_AP_RETAIL_RETAILER_RETRO_FUNDING),
	round(FORECAST_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING),
	round(FORECAST_AP_RETAIL_PROMO_FIXED_SPEND),
	round(FORECAST_AP_RETAIL_TOTAL_SPEND),
	round(FORECAST_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING),
	round(FORECAST_AP_RETAIL_REVENUE_NET_EXCL_MRRSP),
	round(FORECAST_AP_RETAIL_REVENUE_NET_EXCL_RSP),
	round(ACTUALS_TOT_VOL_CA),
	--round(ACTUALS_TOT_VOL_UL),
	round(BASE_TOT_VOL_CA),
	round(BASE_TOT_VOL_UL),
	--round(FORECAST_TOT_VOL_CA),
	round(FORECAST_TOT_VOL_UL),
	round(PRM_ACTUALS_TOT_VOL_CU),
	round(PRM_BASE_TOT_VOL_CU),
	round(PRM_FORECAST_TOT_VOL_CU),
	round(PRM_SI_B_VOL_CU),
	round(PRM_SI_A_VOL_CU),
	round(PRM_SI_T_VOL_CU),
	round(PRM_SI_M_VOL_CU),
	round(PRM_SI_I_VOL_CU),
    PRM_ACTUALS_TOT_VOL_PK,
	PRM_BASE_TOT_VOL_PK,
	PRM_FORECAST_TOT_VOL_PK,
	PRM_SI_B_VOL_PK,
	PRM_SI_A_VOL_PK,
	PRM_SI_T_VOL_PK,
	PRM_SI_M_VOL_PK,
	PRM_SI_I_VOL_PK,
    "PROMO_ID"           ,      
    "PROMO_CODE"           ,      
    "PROMO_DESC"           ,      
    "PROMO_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DISCOUNT"           ,      
    "PROMO_SUB_TACTIC_ISACTIVE"           ,      
    "PROMO_STAT_DESC"           ,      
    "PROMO_PHASE_DESC"           ,      
    trunc("PROMO_PHASE_LENGTH") PROMO_PHASE_LENGTH           ,      
    "PROMO_PHASE_EFFECT_DESC"           ,      
    "PROMO_PHASE_TYPE_DESC"           ,      
    "PROMO_PHASE_TYPE_UNIT"           ,      
    "AUTHORIZED_USER_NAME"           ,      
    "BUY_IN_START_DT"           ,      
    "BUY_IN_END_DT"           ,      
    "IN_STORE_START_DT"           ,      
    "IN_STORE_END_DT"           ,      
    "PERFORMANCE_START_DT"           ,      
    "PERFORMANCE_END_DT"           ,      
    "FEATURE"           ,      
    "FEATURE_DESC"           ,      
    "PROMO_MECHANIC_NAME"           ,      
    "MARKET"           ,      
    "SUBMARKET"           ,      
    "TRADE_CLASS"           ,      
    "TRADE_GROUP"           ,      
    "TRADE_TYPE"           ,      
    "TRADE_SECTOR"           ,      
    "DESCRIPTION"           ,      
    "ITEM_TYPE"           ,      
    "BRANDING_DESC"           ,      
    "PRODUCT_CLASS_DESC"           ,      
    "SUB_PRODUCT_DESC"           ,      
    "STRATEGIC_DESC"           ,      
    "POWER_BRAND_DESC"           ,      
    "MANUFACTURING_GROUP_DESC"           ,      
    "CATEGORY_DESC"           ,      
    "PACK_SIZE_DESC"           ,      
    "SUB_CATEGORY_DESC"           ,      
    "PROMO_TYPE_DESC"           ,      
    "REPORT_FISCAL_YEAR"           ,      
    "REPORT_FISCAL_YEAR_PERIOD_NO"           ,      
    "FISCAL_YEAR_BEGIN_DT"           ,      
    "FISCAL_YEAR_END_DT"           ,      
    "PLANNING_WEEK_CODE"           ,      
    "PLANNING_WEEK_START_DT"           ,      
    "PLANNING_WEEK_END_DT"           ,      
    "PLANNING_WEEK_NO"           ,      
    "PLANNING_MONTH_CODE"           ,      
    "PLANNING_MONTH_START_DT"           ,      
    "PLANNING_MONTH_END_DT"           ,      
    "PLANNING_QUARTER_NO"           ,      
    "PLANNING_QUARTER_START_DT"           ,      
    "PLANNING_QUARTER_END_DT"           ,      
    "PLANNING_YEAR_NO"           ,      
    "PLANNING_YEAR_START_DT"           ,      
    "PLANNING_YEAR_END_DT"           ,      
    "BILL_NAME"      

from wbx_DEV.ZZ_AKUMAR.v_sls_wtx_promo_summary


),

a_intersect_b as (

    select * from a
    

    intersect


    select * from b

),

a_except_b as (

    select * from a
    

    except


    select * from b

),
--select * from a_except_b limit 10;
b_except_a as (

    select * from b
    

    except


    select * from a

),

all_records as (

    select
        *,
        true as in_a,
        true as in_b
    from a_intersect_b

    union all

    select
        *,
        true as in_a,
        false as in_b
    from a_except_b

    union all

    select
        *,
        false as in_a,
        true as in_b
    from b_except_a

),

summary_stats as (

    select

        in_a,
        in_b,
        count(*) as count

    from all_records
    group by 1, 2

),

final as (

    select

        *,
        round(100.0 * count / sum(count) over (), 2) as percent_of_total

    from summary_stats
    order by in_a desc, in_b desc

)
select * from final

