{{ config( 
    enabled=false,
    severity = 'warn',
    warn_if = '>1'  
) }} 

select YEAR_GL_DATE,value_type,"'AX'" AX,"'D365'" D365, "'AX'"-"'D365'" difference, case when "'AX'" <>0 then abs((("'AX'"-"'D365'")/"'AX'")*100) else 0 end "difference_perc%" from (
select * from (
select * from (
select   
'AX' SOURCE_SYSTEM,
year(LINE_GL_DATE)  YEAR_GL_DATE,
sum(to_number(SHORT_PRIM_QUANTITY,20,2)) SHORT_PRIM_QUANTITY,
sum(to_number(ORDERED_PRIM_QUANTITY,20,2)) ORDERED_PRIM_QUANTITY,
sum(to_number(SHIPPED_PRIM_QUANTITY,20,2)) SHIPPED_PRIM_QUANTITY,
sum(to_number(BACKORDER_PRIM_QUANTITY,20,2)) BACKORDER_PRIM_QUANTITY,
sum(to_number(CANCELLED_PRIM_QUANTITY,20,2)) CANCELLED_PRIM_QUANTITY,
sum(to_number(ORDERED_CWT_QUANTITY,20,2)) ORDERED_CWT_QUANTITY,
sum(to_number(SHIPPED_CWT_QUANTITY,20,2)) SHIPPED_CWT_QUANTITY,
sum(to_number(BACKORD_CWT_QUANTITY,20,2)) BACKORD_CWT_QUANTITY,
sum(to_number(CANCEL_CWT_QUANTITY,20,2)) CANCEL_CWT_QUANTITY,
sum(to_number(SHORT_CWT_QUANTITY,20,2)) SHORT_CWT_QUANTITY,
sum(to_number(ORDERED_CA_QUANTITY,20,2)) ORDERED_CA_QUANTITY,
sum(to_number(SHIPPED_CA_QUANTITY,20,2)) SHIPPED_CA_QUANTITY,
sum(to_number(BACKORD_CA_QUANTITY,20,2)) BACKORD_CA_QUANTITY,
sum(to_number(CANCEL_CA_QUANTITY,20,2)) CANCEL_CA_QUANTITY,
sum(to_number(SHORT_CA_QUANTITY,20,2)) SHORT_CA_QUANTITY,
sum(to_number(ORDERED_TRAN_QUANTITY,20,2)) ORDERED_TRAN_QUANTITY,
sum(to_number(SHIPPED_TRAN_QUANTITY,20,2)) SHIPPED_TRAN_QUANTITY,
sum(to_number(CANCEL_TRAN_QUANTITY,20,2)) CANCEL_TRAN_QUANTITY,
sum(to_number(SHORT_TRAN_QUANTITY,20,2)) SHORT_TRAN_QUANTITY,
sum(to_number(BACKORD_TRAN_QUANTITY,20,2)) BACKORD_TRAN_QUANTITY,
sum(to_number(ORDERED_UL_QUANTITY,20,2)) ORDERED_UL_QUANTITY,
sum(to_number(SHIPPED_UL_QUANTITY,20,2)) SHIPPED_UL_QUANTITY,
sum(to_number(SHORT_UL_QUANTITY,20,2)) SHORT_UL_QUANTITY,
sum(to_number(BACKORD_UL_QUANTITY,20,2)) BACKORD_UL_QUANTITY,
sum(to_number(CANCEL_UL_QUANTITY,20,2)) CANCEL_UL_QUANTITY,
sum(to_number(ORDERED_KG_QUANTITY,20,2)) ORDERED_KG_QUANTITY,
sum(to_number(SHIPPED_KG_QUANTITY,20,2)) SHIPPED_KG_QUANTITY,
sum(to_number(CANCEL_KG_QUANTITY,20,2)) CANCEL_KG_QUANTITY,
sum(to_number(BACKORD_KG_QUANTITY,20,2)) BACKORD_KG_QUANTITY,
sum(to_number(SHORT_KG_QUANTITY,20,2)) SHORT_KG_QUANTITY,
sum(to_number(OPEN_PRIM_QUANTITY,20,2)) OPEN_PRIM_QUANTITY,
sum(to_number(OPEN_CWT_QUANTITY,20,2)) OPEN_CWT_QUANTITY,
sum(to_number(OPEN_TRAN_QUANTITY,20,2)) OPEN_TRAN_QUANTITY,
sum(to_number(OPEN_UL_QUANTITY,20,2)) OPEN_UL_QUANTITY,
sum(to_number(OPEN_KG_QUANTITY,20,2)) OPEN_KG_QUANTITY,
sum(to_number(SALES_PRIM_QUANTITY,20,2)) SALES_PRIM_QUANTITY,
sum(to_number(SALES_CWT_QUANTITY,20,2)) SALES_CWT_QUANTITY,
sum(to_number(SALES_CA_QUANTITY,20,2)) SALES_CA_QUANTITY,
sum(to_number(SALES_TRAN_QUANTITY,20,2)) SALES_TRAN_QUANTITY,
sum(to_number(SALES_UL_QUANTITY,20,2)) SALES_UL_QUANTITY,
sum(to_number(SALES_KG_QUANTITY,20,2)) SALES_KG_QUANTITY,
sum(to_number(TRANS_QUANTITY_CONFIRMED,20,2)) TRANS_QUANTITY_CONFIRMED,
sum(to_number(PRIM_QUANTITY_CONFIRMED,20,2)) PRIM_QUANTITY_CONFIRMED,
sum(to_number(CWT_QUANTITY_CONFIRMED,20,2)) CWT_QUANTITY_CONFIRMED,
sum(to_number(KG_QUANTITY_CONFIRMED,20,2)) KG_QUANTITY_CONFIRMED,
sum(to_number(CA_QUANTITY_CONFIRMED,20,2)) CA_QUANTITY_CONFIRMED,
sum(to_number(OPEN_CA_QUANTITY,20,2)) OPEN_CA_QUANTITY,
sum(to_number(BASE_OPEN_AMT,20,2)) BASE_OPEN_AMT,
sum(to_number(BASE_RPT_GRS_PRIM_AMT,20,2)) BASE_RPT_GRS_PRIM_AMT,
sum(to_number(BASE_RPT_NET_PRIM_AMT,20,2)) BASE_RPT_NET_PRIM_AMT,
sum(to_number(PHI_RPT_GRS_PRIM_AMT,20,2)) PHI_RPT_GRS_PRIM_AMT,
sum(to_number(PHI_RPT_NET_PRIM_AMT,20,2)) PHI_RPT_NET_PRIM_AMT,
sum(to_number(PCOMP_RPT_GRS_PRIM_AMT,20,2)) PCOMP_RPT_GRS_PRIM_AMT,
sum(to_number(PCOMP_RPT_NET_PRIM_AMT,20,2)) PCOMP_RPT_NET_PRIM_AMT,
sum(to_number(PHI_M_GRS_PRIM_AMT,20,2)) PHI_M_GRS_PRIM_AMT,
sum(to_number(PHI_M_NET_PRIM_AMT,20,2)) PHI_M_NET_PRIM_AMT,
sum(to_number(PCOMP_M_GRS_PRIM_AMT,20,2)) PCOMP_M_GRS_PRIM_AMT,
sum(to_number(PCOMP_M_NET_PRIM_AMT,20,2)) PCOMP_M_NET_PRIM_AMT,
sum(to_number(TRANS_RPT_GRS_AMT,20,2)) TRANS_RPT_GRS_AMT,
sum(to_number(TRANS_RPT_NET_AMT,20,2)) TRANS_RPT_NET_AMT,
sum(to_number(TRANS_DEDUCTION_01_AMT,20,2)) TRANS_DEDUCTION_01_AMT,
sum(to_number(TRANS_DEDUCTION_02_AMT,20,2)) TRANS_DEDUCTION_02_AMT,
sum(to_number(TRANS_DEDUCTION_03_AMT,20,2)) TRANS_DEDUCTION_03_AMT,
sum(to_number(BASE_DEDUCTION_01_AMT,20,2)) BASE_DEDUCTION_01_AMT,
sum(to_number(BASE_DEDUCTION_02_AMT,20,2)) BASE_DEDUCTION_02_AMT,
sum(to_number(BASE_DEDUCTION_03_AMT,20,2)) BASE_DEDUCTION_03_AMT,
sum(to_number(PHI_DEDUCTION_01_AMT,20,2)) PHI_DEDUCTION_01_AMT,
sum(to_number(PHI_DEDUCTION_02_AMT,20,2)) PHI_DEDUCTION_02_AMT,
sum(to_number(PHI_DEDUCTION_03_AMT,20,2)) PHI_DEDUCTION_03_AMT,
sum(to_number(PCOMP_DEDUCTION_01_AMT,20,2)) PCOMP_DEDUCTION_01_AMT,
sum(to_number(PCOMP_DEDUCTION_02_AMT,20,2)) PCOMP_DEDUCTION_02_AMT,
sum(to_number(PCOMP_DEDUCTION_03_AMT,20,2)) PCOMP_DEDUCTION_03_AMT,
sum(to_number(TRANS_INVOICE_GRS_AMT,20,2)) TRANS_INVOICE_GRS_AMT,
sum(to_number(TRANS_INVOICE_NET_AMT,20,2)) TRANS_INVOICE_NET_AMT,
sum(to_number(BASE_INVOICE_GRS_AMT,20,2)) BASE_INVOICE_GRS_AMT,
sum(to_number(BASE_INVOICE_NET_AMT,20,2)) BASE_INVOICE_NET_AMT,
sum(to_number(PHI_INVOICE_GRS_AMT,20,2)) PHI_INVOICE_GRS_AMT,
sum(to_number(PHI_INVOICE_NET_AMT,20,2)) PHI_INVOICE_NET_AMT,
sum(to_number(PCOMP_INVOICE_GRS_AMT,20,2)) PCOMP_INVOICE_GRS_AMT,
sum(to_number(PCOMP_INVOICE_NET_AMT,20,2)) PCOMP_INVOICE_NET_AMT,
sum(to_number(TRANS_INVOICE_DISC_AMT,20,2)) TRANS_INVOICE_DISC_AMT,
sum(to_number(BASE_INVOICE_DISC_AMT,20,2)) BASE_INVOICE_DISC_AMT,
sum(to_number(PHI_INVOICE_DISC_AMT,20,2)) PHI_INVOICE_DISC_AMT,
sum(to_number(PCOMP_INVOICE_DISC_AMT,20,2)) PCOMP_INVOICE_DISC_AMT
     
from   "WBX_PROD"."FACT"."FCT_WBX_SLS_ORDER" where division in ('WBX')
  group by  Year(LINE_GL_DATE)

union all

select  
'D365' SOURCE_SYSTEM,
year(LINE_GL_DATE)  YEAR_GL_DATE,
sum(to_number(SHORT_PRIM_QUANTITY,20,2)) SHORT_PRIM_QUANTITY,
sum(to_number(ORDERED_PRIM_QUANTITY,20,2)) ORDERED_PRIM_QUANTITY,
sum(to_number(SHIPPED_PRIM_QUANTITY,20,2)) SHIPPED_PRIM_QUANTITY,
sum(to_number(BACKORDER_PRIM_QUANTITY,20,2)) BACKORDER_PRIM_QUANTITY,
sum(to_number(CANCELLED_PRIM_QUANTITY,20,2)) CANCELLED_PRIM_QUANTITY,
sum(to_number(ORDERED_CWT_QUANTITY,20,2)) ORDERED_CWT_QUANTITY,
sum(to_number(SHIPPED_CWT_QUANTITY,20,2)) SHIPPED_CWT_QUANTITY,
sum(to_number(BACKORD_CWT_QUANTITY,20,2)) BACKORD_CWT_QUANTITY,
sum(to_number(CANCEL_CWT_QUANTITY,20,2)) CANCEL_CWT_QUANTITY,
sum(to_number(SHORT_CWT_QUANTITY,20,2)) SHORT_CWT_QUANTITY,
sum(to_number(ORDERED_CA_QUANTITY,20,2)) ORDERED_CA_QUANTITY,
sum(to_number(SHIPPED_CA_QUANTITY,20,2)) SHIPPED_CA_QUANTITY,
sum(to_number(BACKORD_CA_QUANTITY,20,2)) BACKORD_CA_QUANTITY,
sum(to_number(CANCEL_CA_QUANTITY,20,2)) CANCEL_CA_QUANTITY,
sum(to_number(SHORT_CA_QUANTITY,20,2)) SHORT_CA_QUANTITY,
sum(to_number(ORDERED_TRAN_QUANTITY,20,2)) ORDERED_TRAN_QUANTITY,
sum(to_number(SHIPPED_TRAN_QUANTITY,20,2)) SHIPPED_TRAN_QUANTITY,
sum(to_number(CANCEL_TRAN_QUANTITY,20,2)) CANCEL_TRAN_QUANTITY,
sum(to_number(SHORT_TRAN_QUANTITY,20,2)) SHORT_TRAN_QUANTITY,
sum(to_number(BACKORD_TRAN_QUANTITY,20,2)) BACKORD_TRAN_QUANTITY,
sum(to_number(ORDERED_UL_QUANTITY,20,2)) ORDERED_UL_QUANTITY,
sum(to_number(SHIPPED_UL_QUANTITY,20,2)) SHIPPED_UL_QUANTITY,
sum(to_number(SHORT_UL_QUANTITY,20,2)) SHORT_UL_QUANTITY,
sum(to_number(BACKORD_UL_QUANTITY,20,2)) BACKORD_UL_QUANTITY,
sum(to_number(CANCEL_UL_QUANTITY,20,2)) CANCEL_UL_QUANTITY,
sum(to_number(ORDERED_KG_QUANTITY,20,2)) ORDERED_KG_QUANTITY,
sum(to_number(SHIPPED_KG_QUANTITY,20,2)) SHIPPED_KG_QUANTITY,
sum(to_number(CANCEL_KG_QUANTITY,20,2)) CANCEL_KG_QUANTITY,
sum(to_number(BACKORD_KG_QUANTITY,20,2)) BACKORD_KG_QUANTITY,
sum(to_number(SHORT_KG_QUANTITY,20,2)) SHORT_KG_QUANTITY,
sum(to_number(OPEN_PRIM_QUANTITY,20,2)) OPEN_PRIM_QUANTITY,
sum(to_number(OPEN_CWT_QUANTITY,20,2)) OPEN_CWT_QUANTITY,
sum(to_number(OPEN_TRAN_QUANTITY,20,2)) OPEN_TRAN_QUANTITY,
sum(to_number(OPEN_UL_QUANTITY,20,2)) OPEN_UL_QUANTITY,
sum(to_number(OPEN_KG_QUANTITY,20,2)) OPEN_KG_QUANTITY,
sum(to_number(SALES_PRIM_QUANTITY,20,2)) SALES_PRIM_QUANTITY,
sum(to_number(SALES_CWT_QUANTITY,20,2)) SALES_CWT_QUANTITY,
sum(to_number(SALES_CA_QUANTITY,20,2)) SALES_CA_QUANTITY,
sum(to_number(SALES_TRAN_QUANTITY,20,2)) SALES_TRAN_QUANTITY,
sum(to_number(SALES_UL_QUANTITY,20,2)) SALES_UL_QUANTITY,
sum(to_number(SALES_KG_QUANTITY,20,2)) SALES_KG_QUANTITY,
sum(to_number(TRANS_QUANTITY_CONFIRMED,20,2)) TRANS_QUANTITY_CONFIRMED,
sum(to_number(PRIM_QUANTITY_CONFIRMED,20,2)) PRIM_QUANTITY_CONFIRMED,
sum(to_number(CWT_QUANTITY_CONFIRMED,20,2)) CWT_QUANTITY_CONFIRMED,
sum(to_number(KG_QUANTITY_CONFIRMED,20,2)) KG_QUANTITY_CONFIRMED,
sum(to_number(CA_QUANTITY_CONFIRMED,20,2)) CA_QUANTITY_CONFIRMED,
sum(to_number(OPEN_CA_QUANTITY,20,2)) OPEN_CA_QUANTITY,
sum(to_number(BASE_OPEN_AMT,20,2)) BASE_OPEN_AMT,
sum(to_number(BASE_RPT_GRS_PRIM_AMT,20,2)) BASE_RPT_GRS_PRIM_AMT,
sum(to_number(BASE_RPT_NET_PRIM_AMT,20,2)) BASE_RPT_NET_PRIM_AMT,
sum(to_number(PHI_RPT_GRS_PRIM_AMT,20,2)) PHI_RPT_GRS_PRIM_AMT,
sum(to_number(PHI_RPT_NET_PRIM_AMT,20,2)) PHI_RPT_NET_PRIM_AMT,
sum(to_number(PCOMP_RPT_GRS_PRIM_AMT,20,2)) PCOMP_RPT_GRS_PRIM_AMT,
sum(to_number(PCOMP_RPT_NET_PRIM_AMT,20,2)) PCOMP_RPT_NET_PRIM_AMT,
sum(to_number(PHI_M_GRS_PRIM_AMT,20,2)) PHI_M_GRS_PRIM_AMT,
sum(to_number(PHI_M_NET_PRIM_AMT,20,2)) PHI_M_NET_PRIM_AMT,
sum(to_number(PCOMP_M_GRS_PRIM_AMT,20,2)) PCOMP_M_GRS_PRIM_AMT,
sum(to_number(PCOMP_M_NET_PRIM_AMT,20,2)) PCOMP_M_NET_PRIM_AMT,
sum(to_number(TRANS_RPT_GRS_AMT,20,2)) TRANS_RPT_GRS_AMT,
sum(to_number(TRANS_RPT_NET_AMT,20,2)) TRANS_RPT_NET_AMT,
sum(to_number(TRANS_DEDUCTION_01_AMT,20,2)) TRANS_DEDUCTION_01_AMT,
sum(to_number(TRANS_DEDUCTION_02_AMT,20,2)) TRANS_DEDUCTION_02_AMT,
sum(to_number(TRANS_DEDUCTION_03_AMT,20,2)) TRANS_DEDUCTION_03_AMT,
sum(to_number(BASE_DEDUCTION_01_AMT,20,2)) BASE_DEDUCTION_01_AMT,
sum(to_number(BASE_DEDUCTION_02_AMT,20,2)) BASE_DEDUCTION_02_AMT,
sum(to_number(BASE_DEDUCTION_03_AMT,20,2)) BASE_DEDUCTION_03_AMT,
sum(to_number(PHI_DEDUCTION_01_AMT,20,2)) PHI_DEDUCTION_01_AMT,
sum(to_number(PHI_DEDUCTION_02_AMT,20,2)) PHI_DEDUCTION_02_AMT,
sum(to_number(PHI_DEDUCTION_03_AMT,20,2)) PHI_DEDUCTION_03_AMT,
sum(to_number(PCOMP_DEDUCTION_01_AMT,20,2)) PCOMP_DEDUCTION_01_AMT,
sum(to_number(PCOMP_DEDUCTION_02_AMT,20,2)) PCOMP_DEDUCTION_02_AMT,
sum(to_number(PCOMP_DEDUCTION_03_AMT,20,2)) PCOMP_DEDUCTION_03_AMT,
sum(to_number(TRANS_INVOICE_GRS_AMT,20,2)) TRANS_INVOICE_GRS_AMT,
sum(to_number(TRANS_INVOICE_NET_AMT,20,2)) TRANS_INVOICE_NET_AMT,
sum(to_number(BASE_INVOICE_GRS_AMT,20,2)) BASE_INVOICE_GRS_AMT,
sum(to_number(BASE_INVOICE_NET_AMT,20,2)) BASE_INVOICE_NET_AMT,
sum(to_number(PHI_INVOICE_GRS_AMT,20,2)) PHI_INVOICE_GRS_AMT,
sum(to_number(PHI_INVOICE_NET_AMT,20,2)) PHI_INVOICE_NET_AMT,
sum(to_number(PCOMP_INVOICE_GRS_AMT,20,2)) PCOMP_INVOICE_GRS_AMT,
sum(to_number(PCOMP_INVOICE_NET_AMT,20,2)) PCOMP_INVOICE_NET_AMT,
sum(to_number(TRANS_INVOICE_DISC_AMT,20,2)) TRANS_INVOICE_DISC_AMT,
sum(to_number(BASE_INVOICE_DISC_AMT,20,2)) BASE_INVOICE_DISC_AMT,
sum(to_number(PHI_INVOICE_DISC_AMT,20,2)) PHI_INVOICE_DISC_AMT,
sum(to_number(PCOMP_INVOICE_DISC_AMT,20,2)) PCOMP_INVOICE_DISC_AMT
  
from   WBX_DEV.ZZ_RRAJAGOPALAN.fct_wbx_sls_order  where division in ('WBX')
  group by  Year(LINE_GL_DATE)
 ) 
  unpivot(value_of for value_type in 
          (
SHORT_PRIM_QUANTITY,
ORDERED_PRIM_QUANTITY,
SHIPPED_PRIM_QUANTITY,
BACKORDER_PRIM_QUANTITY,
CANCELLED_PRIM_QUANTITY,
ORDERED_CWT_QUANTITY,
SHIPPED_CWT_QUANTITY,
BACKORD_CWT_QUANTITY,
CANCEL_CWT_QUANTITY,
SHORT_CWT_QUANTITY,
ORDERED_CA_QUANTITY,
SHIPPED_CA_QUANTITY,
BACKORD_CA_QUANTITY,
CANCEL_CA_QUANTITY,
SHORT_CA_QUANTITY,
ORDERED_TRAN_QUANTITY,
SHIPPED_TRAN_QUANTITY,
CANCEL_TRAN_QUANTITY,
SHORT_TRAN_QUANTITY,
BACKORD_TRAN_QUANTITY,
ORDERED_UL_QUANTITY,
SHIPPED_UL_QUANTITY,
SHORT_UL_QUANTITY,
BACKORD_UL_QUANTITY,
CANCEL_UL_QUANTITY,
ORDERED_KG_QUANTITY,
SHIPPED_KG_QUANTITY,
CANCEL_KG_QUANTITY,
BACKORD_KG_QUANTITY,
SHORT_KG_QUANTITY,
OPEN_PRIM_QUANTITY,
OPEN_CWT_QUANTITY,
OPEN_TRAN_QUANTITY,
OPEN_UL_QUANTITY,
OPEN_KG_QUANTITY,
SALES_PRIM_QUANTITY,
SALES_CWT_QUANTITY,
SALES_CA_QUANTITY,
SALES_TRAN_QUANTITY,
SALES_UL_QUANTITY,
SALES_KG_QUANTITY,
TRANS_QUANTITY_CONFIRMED,
PRIM_QUANTITY_CONFIRMED,
CWT_QUANTITY_CONFIRMED,
KG_QUANTITY_CONFIRMED,
CA_QUANTITY_CONFIRMED,
OPEN_CA_QUANTITY,
BASE_OPEN_AMT,
BASE_RPT_GRS_PRIM_AMT,
BASE_RPT_NET_PRIM_AMT,
PHI_RPT_GRS_PRIM_AMT,
PHI_RPT_NET_PRIM_AMT,
PCOMP_RPT_GRS_PRIM_AMT,
PCOMP_RPT_NET_PRIM_AMT,
PHI_M_GRS_PRIM_AMT,
PHI_M_NET_PRIM_AMT,
PCOMP_M_GRS_PRIM_AMT,
PCOMP_M_NET_PRIM_AMT,
TRANS_RPT_GRS_AMT,
TRANS_RPT_NET_AMT,
TRANS_DEDUCTION_01_AMT,
TRANS_DEDUCTION_02_AMT,
TRANS_DEDUCTION_03_AMT,
BASE_DEDUCTION_01_AMT,
BASE_DEDUCTION_02_AMT,
BASE_DEDUCTION_03_AMT,
PHI_DEDUCTION_01_AMT,
PHI_DEDUCTION_02_AMT,
PHI_DEDUCTION_03_AMT,
PCOMP_DEDUCTION_01_AMT,
PCOMP_DEDUCTION_02_AMT,
PCOMP_DEDUCTION_03_AMT,
TRANS_INVOICE_GRS_AMT,
TRANS_INVOICE_NET_AMT,
BASE_INVOICE_GRS_AMT,
BASE_INVOICE_NET_AMT,
PHI_INVOICE_GRS_AMT,
PHI_INVOICE_NET_AMT,
PCOMP_INVOICE_GRS_AMT,
PCOMP_INVOICE_NET_AMT,
TRANS_INVOICE_DISC_AMT,
BASE_INVOICE_DISC_AMT,
PHI_INVOICE_DISC_AMT,
PCOMP_INVOICE_DISC_AMT
)
)
 where nvl(year_gl_date,0) > 2018   
)
 pivot(sum(value_of) for source_system in ('AX', 'D365')) 
      as p
)
order by 1,2