{{ config( 
  enabled=false, 
  snowflake_warehouse=env_var("DBT_WBX_SF_WH"),
  severity = 'warn', 
  warn_if = '>0' ,
  tags=["sales","promo","sales_promo_summary"]

) }} 

--All fields are included in test. PROMO_PHASE_LENGTH has .000 in iics but not in dbt. hence compiled this model and used trunc in comparision

with a as (

    
select
   "SOURCE_SYSTEM"           ,      
    "SOURCE_ITEM_IDENTIFIER"           ,      
    "PLAN_SOURCE_CUSTOMER_CODE"           ,      
    "CALENDAR_DATE"           ,      
    "SNAPSHOT_DATE"           ,      
    "FROZEN_FORECAST"           ,      
    "FROZEN_FORECAST_DELINEATION_DATE"           ,      
    "SOURCE_CONTENT_FILTER"           ,      
    "ISPROMOSKU"           ,      
    "ISCANNIBSKU"           ,      
    "SI_B_VOL_CSE"           ,      
    "SI_A_VOL_CSE"           ,      
    "SI_T_VOL_CSE"           ,      
    "SI_M_VOL_CSE"           ,      
    "SI_I_VOL_CSE"           ,      
    "SI_B_VOL_KG"           ,      
    "SI_A_VOL_KG"           ,      
    "SI_T_VOL_KG"           ,      
    "SI_M_VOL_KG"           ,      
    "ACTUALS_TOT_VOL_KG"           ,      
    "BASE_TOT_VOL_KG"           ,      
    "FORECAST_TOT_VOL_KG"           ,      
    "SI_I_VOL_KG"           ,      
    "ACTUALS_AP_GROSS_SALES_VALUE"           ,      
    "ACTUALS_AP_RANGE_SUPPORT_ALLOWANCE"           ,      
    "ACTUALS_AP_EVERYDAY_LOW_PRICES"           ,      
    "ACTUALS_AP_PERMANENT_DISC"           ,      
    "ACTUALS_AP_OFF_INVOICE_DISC"           ,      
    "ACTUALS_AP_INVOICED_SALES_VALUE"           ,      
    "ACTUALS_AP_EARLY_SETTLEMENT_DISC"           ,      
    "ACTUALS_AP_GROWTH_INCENTIVES"           ,      
    "ACTUALS_AP_NET_SALES_VALUE"           ,      
    "ACTUALS_AP_RETRO"           ,      
    "ACTUALS_AP_AVP_DISC"           ,      
    "ACTUALS_AP_VARIABLE_TRADE"           ,      
    "ACTUALS_AP_PROMO_FIXED_FUNDING"           ,      
    "ACTUALS_AP_RANGE_SUPPORT_INCENTIVES"           ,      
    "ACTUALS_AP_NET_NET_SALES_VALUE"           ,      
    "ACTUALS_AP_DIRECT_SHOPPER_MARKETING"           ,      
    "ACTUALS_AP_OTHER_DIRECT_PAYMENTS"           ,      
    "ACTUALS_AP_INDIRECT_SHOPPER_MARKETING"           ,      
    "ACTUALS_AP_OTHER_INDIRECT_PAYMENTS"           ,      
    "ACTUALS_AP_FIXED_TRADE_CUST_INVOICED"           ,      
    "ACTUALS_AP_TOTAL_TRADE_CUST_INVOICED"           ,      
    "ACTUALS_AP_FIXED_TRADE_NON_CUST_INVOICED"           ,      
    "ACTUALS_AP_TOTAL_TRADE"           ,      
    "ACTUALS_AP_NET_REALISABLE_REVENUE"           ,      
    "ACTUALS_AP_TOT_PRIME_COST_STANDARD"           ,      
    "ACTUALS_AP_GROSS_MARGIN_STANDARD"           ,      
    "ACTUALS_AP_GCAT_STANDARD"           ,      
    "ACTUALS_RETAIL_TOT_VOL_KG"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_MRRSP"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_RSP"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_NET"           ,      
    "ACTUALS_AP_RETAIL_COST_OF_SALES"           ,      
    "ACTUALS_AP_RETAIL_RETAILER_RETRO_FUNDING"           ,      
    "ACTUALS_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING"           ,      
    "ACTUALS_AP_RETAIL_PROMO_FIXED_SPEND"           ,      
    "ACTUALS_AP_RETAIL_TOTAL_SPEND"           ,      
    "ACTUALS_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_MRRSP"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_RSP"           ,      
    "BASE_AP_GROSS_SALES_VALUE"           ,      
    "BASE_AP_RANGE_SUPPORT_ALLOWANCE"           ,      
    "BASE_AP_EVERYDAY_LOW_PRICES"           ,      
    "BASE_AP_PERMANENT_DISC"           ,      
    "BASE_AP_OFF_INVOICE_DISC"           ,      
    "BASE_AP_INVOICED_SALES_VALUE"           ,      
    "BASE_AP_EARLY_SETTLEMENT_DISC"           ,      
    "BASE_AP_GROWTH_INCENTIVES"           ,      
    "BASE_AP_NET_SALES_VALUE"           ,      
    "BASE_AP_RETRO"           ,      
    "BASE_AP_AVP_DISC"           ,      
    "BASE_AP_VARIABLE_TRADE"           ,      
    "BASE_AP_PROMO_FIXED_FUNDING"           ,      
    "BASE_AP_RANGE_SUPPORT_INCENTIVES"           ,      
    "BASE_AP_NET_NET_SALES_VALUE"           ,      
    "BASE_AP_DIRECT_SHOPPER_MARKETING"           ,      
    "BASE_AP_OTHER_DIRECT_PAYMENTS"           ,      
    "BASE_AP_INDIRECT_SHOPPER_MARKETING"           ,      
    "BASE_AP_OTHER_INDIRECT_PAYMENTS"           ,      
    "BASE_AP_FIXED_TRADE_CUST_INVOICED"           ,      
    "BASE_AP_TOTAL_TRADE_CUST_INVOICED"           ,      
    "BASE_AP_FIXED_TRADE_NON_CUST_INVOICED"           ,      
    "BASE_AP_TOTAL_TRADE"           ,      
    "BASE_AP_NET_REALISABLE_REVENUE"           ,      
    "BASE_AP_TOT_PRIME_COST_STANDARD"           ,      
    "BASE_AP_GROSS_MARGIN_STANDARD"           ,      
    "BASE_AP_GCAT_STANDARD"           ,      
    "BASE_RETAIL_TOT_VOL_KG"           ,      
    "BASE_AP_RETAIL_REVENUE_MRRSP"           ,      
    "BASE_AP_RETAIL_REVENUE_RSP"           ,      
    "BASE_AP_RETAIL_REVENUE_NET"           ,      
    "BASE_AP_RETAIL_COST_OF_SALES"           ,      
    "BASE_AP_RETAIL_RETAILER_RETRO_FUNDING"           ,      
    "BASE_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING"           ,      
    "BASE_AP_RETAIL_PROMO_FIXED_SPEND"           ,      
    "BASE_AP_RETAIL_TOTAL_SPEND"           ,      
    "BASE_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING"           ,      
    "BASE_AP_RETAIL_REVENUE_NET_EXCL_MRRSP"           ,      
    "BASE_AP_RETAIL_REVENUE_NET_EXCL_RSP"           ,      
    "FORECAST_AP_GROSS_SALES_VALUE"           ,      
    "FORECAST_AP_RANGE_SUPPORT_ALLOWANCE"           ,      
    "FORECAST_AP_EVERYDAY_LOW_PRICES"           ,      
    "FORECAST_AP_PERMANENT_DISC"           ,      
    "FORECAST_AP_OFF_INVOICE_DISC"           ,      
    "FORECAST_AP_INVOICED_SALES_VALUE"           ,      
    "FORECAST_AP_EARLY_SETTLEMENT_DISC"           ,      
    "FORECAST_AP_GROWTH_INCENTIVES"           ,      
    "FORECAST_AP_NET_SALES_VALUE"           ,      
    "FORECAST_AP_RETRO"           ,      
    "FORECAST_AP_AVP_DISC"           ,      
    "FORECAST_AP_VARIABLE_TRADE"           ,      
    "FORECAST_AP_PROMO_FIXED_FUNDING"           ,      
    "FORECAST_AP_RANGE_SUPPORT_INCENTIVES"           ,      
    "FORECAST_AP_NET_NET_SALES_VALUE"           ,      
    "FORECAST_AP_DIRECT_SHOPPER_MARKETING"           ,      
    "FORECAST_AP_OTHER_DIRECT_PAYMENTS"           ,      
    "FORECAST_AP_INDIRECT_SHOPPER_MARKETING"           ,      
    "FORECAST_AP_OTHER_INDIRECT_PAYMENTS"           ,      
    "FORECAST_AP_FIXED_TRADE_CUST_INVOICED"           ,      
    "FORECAST_AP_TOTAL_TRADE_CUST_INVOICED"           ,      
    "FORECAST_AP_FIXED_TRADE_NON_CUST_INVOICED"           ,      
    "FORECAST_AP_TOTAL_TRADE"           ,      
    "FORECAST_AP_TOTAL_TRADE_GBP"           ,      
    "FORECAST_AP_NET_REALISABLE_REVENUE"           ,      
    "FORECAST_AP_TOT_PRIME_COST_STANDARD"           ,      
    "FORECAST_AP_GROSS_MARGIN_STANDARD"           ,      
    "FORECAST_AP_GCAT_STANDARD"           ,      
    "FORECAST_RETAIL_TOT_VOL_KG"           ,      
    "FORECAST_AP_RETAIL_REVENUE_MRRSP"           ,      
    "FORECAST_AP_RETAIL_REVENUE_RSP"           ,      
    "FORECAST_AP_RETAIL_REVENUE_NET"           ,      
    "FORECAST_AP_RETAIL_COST_OF_SALES"           ,      
    "FORECAST_AP_RETAIL_RETAILER_RETRO_FUNDING"           ,      
    "FORECAST_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING"           ,      
    "FORECAST_AP_RETAIL_PROMO_FIXED_SPEND"           ,      
    "FORECAST_AP_RETAIL_TOTAL_SPEND"           ,      
    "FORECAST_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING"           ,      
    "FORECAST_AP_RETAIL_REVENUE_NET_EXCL_MRRSP"           ,      
    "FORECAST_AP_RETAIL_REVENUE_NET_EXCL_RSP"           ,      
    "ACTUALS_TOT_VOL_CA"           ,      
    "ACTUALS_TOT_VOL_UL"           ,      
    "BASE_TOT_VOL_CA"           ,      
    "BASE_TOT_VOL_UL"           ,      
    "FORECAST_TOT_VOL_CA"           ,      
    "FORECAST_TOT_VOL_UL"           ,      
    "PRM_ACTUALS_TOT_VOL_CU"           ,      
    "PRM_BASE_TOT_VOL_CU"           ,      
    "PRM_FORECAST_TOT_VOL_CU"           ,      
    "PRM_SI_B_VOL_CU"           ,      
    "PRM_SI_A_VOL_CU"           ,      
    "PRM_SI_T_VOL_CU"           ,      
    "PRM_SI_M_VOL_CU"           ,      
    "PRM_SI_I_VOL_CU"           ,      
    "PRM_ACTUALS_TOT_VOL_PK"           ,      
    "PRM_BASE_TOT_VOL_PK"           ,      
    "PRM_FORECAST_TOT_VOL_PK"           ,      
    "PRM_SI_B_VOL_PK"           ,      
    "PRM_SI_A_VOL_PK"           ,      
    "PRM_SI_T_VOL_PK"           ,      
    "PRM_SI_M_VOL_PK"           ,      
    "PRM_SI_I_VOL_PK"           ,      
    "PROMO_ID"           ,      
    "PROMO_CODE"           ,      
    "PROMO_DESC"           ,      
    "PROMO_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DISCOUNT"           ,      
    "PROMO_SUB_TACTIC_ISACTIVE"           ,      
    "PROMO_STAT_DESC"           ,      
    "PROMO_PHASE_DESC"           ,      
    trunc("PROMO_PHASE_LENGTH") PROMO_PHASE_LENGTH           ,      
    "PROMO_PHASE_EFFECT_DESC"           ,      
    "PROMO_PHASE_TYPE_DESC"           ,      
    "PROMO_PHASE_TYPE_UNIT"           ,      
    "AUTHORIZED_USER_NAME"           ,      
    "BUY_IN_START_DT"           ,      
    "BUY_IN_END_DT"           ,      
    "IN_STORE_START_DT"           ,      
    "IN_STORE_END_DT"           ,      
    "PERFORMANCE_START_DT"           ,      
    "PERFORMANCE_END_DT"           ,      
    "FEATURE"           ,      
    "FEATURE_DESC"           ,      
    "PROMO_MECHANIC_NAME"           ,      
    "MARKET"           ,      
    "SUBMARKET"           ,      
    "TRADE_CLASS"           ,      
    "TRADE_GROUP"           ,      
    "TRADE_TYPE"           ,      
    "TRADE_SECTOR"           ,      
    "DESCRIPTION"           ,      
    "ITEM_TYPE"           ,      
    "BRANDING_DESC"           ,      
    "PRODUCT_CLASS_DESC"           ,      
    "SUB_PRODUCT_DESC"           ,      
    "STRATEGIC_DESC"           ,      
    "POWER_BRAND_DESC"           ,      
    "MANUFACTURING_GROUP_DESC"           ,      
    "CATEGORY_DESC"           ,      
    "PACK_SIZE_DESC"           ,      
    "SUB_CATEGORY_DESC"           ,      
    "PROMO_TYPE_DESC"           ,      
    "REPORT_FISCAL_YEAR"           ,      
    "REPORT_FISCAL_YEAR_PERIOD_NO"           ,      
    "FISCAL_YEAR_BEGIN_DT"           ,      
    "FISCAL_YEAR_END_DT"           ,      
    "PLANNING_WEEK_CODE"           ,      
    "PLANNING_WEEK_START_DT"           ,      
    "PLANNING_WEEK_END_DT"           ,      
    "PLANNING_WEEK_NO"           ,      
    "PLANNING_MONTH_CODE"           ,      
    "PLANNING_MONTH_START_DT"           ,      
    "PLANNING_MONTH_END_DT"           ,      
    "PLANNING_QUARTER_NO"           ,      
    "PLANNING_QUARTER_START_DT"           ,      
    "PLANNING_QUARTER_END_DT"           ,      
    "PLANNING_YEAR_NO"           ,      
    "PLANNING_YEAR_START_DT"           ,      
    "PLANNING_YEAR_END_DT"           ,      
    "BILL_NAME"      
  

from {{source('FACTS_FOR_COMPARE','v_sls_wtx_promo_summary')}}


),

b as (

    
select
   "SOURCE_SYSTEM"           ,      
    "SOURCE_ITEM_IDENTIFIER"           ,      
    "PLAN_SOURCE_CUSTOMER_CODE"           ,      
    "CALENDAR_DATE"           ,      
    "SNAPSHOT_DATE"           ,      
    "FROZEN_FORECAST"           ,      
    "FROZEN_FORECAST_DELINEATION_DATE"           ,      
    "SOURCE_CONTENT_FILTER"           ,      
    "ISPROMOSKU"           ,      
    "ISCANNIBSKU"           ,      
    "SI_B_VOL_CSE"           ,      
    "SI_A_VOL_CSE"           ,      
    "SI_T_VOL_CSE"           ,      
    "SI_M_VOL_CSE"           ,      
    "SI_I_VOL_CSE"           ,      
    "SI_B_VOL_KG"           ,      
    "SI_A_VOL_KG"           ,      
    "SI_T_VOL_KG"           ,      
    "SI_M_VOL_KG"           ,      
    "ACTUALS_TOT_VOL_KG"           ,      
    "BASE_TOT_VOL_KG"           ,      
    "FORECAST_TOT_VOL_KG"           ,      
    "SI_I_VOL_KG"           ,      
    "ACTUALS_AP_GROSS_SALES_VALUE"           ,      
    "ACTUALS_AP_RANGE_SUPPORT_ALLOWANCE"           ,      
    "ACTUALS_AP_EVERYDAY_LOW_PRICES"           ,      
    "ACTUALS_AP_PERMANENT_DISC"           ,      
    "ACTUALS_AP_OFF_INVOICE_DISC"           ,      
    "ACTUALS_AP_INVOICED_SALES_VALUE"           ,      
    "ACTUALS_AP_EARLY_SETTLEMENT_DISC"           ,      
    "ACTUALS_AP_GROWTH_INCENTIVES"           ,      
    "ACTUALS_AP_NET_SALES_VALUE"           ,      
    "ACTUALS_AP_RETRO"           ,      
    "ACTUALS_AP_AVP_DISC"           ,      
    "ACTUALS_AP_VARIABLE_TRADE"           ,      
    "ACTUALS_AP_PROMO_FIXED_FUNDING"           ,      
    "ACTUALS_AP_RANGE_SUPPORT_INCENTIVES"           ,      
    "ACTUALS_AP_NET_NET_SALES_VALUE"           ,      
    "ACTUALS_AP_DIRECT_SHOPPER_MARKETING"           ,      
    "ACTUALS_AP_OTHER_DIRECT_PAYMENTS"           ,      
    "ACTUALS_AP_INDIRECT_SHOPPER_MARKETING"           ,      
    "ACTUALS_AP_OTHER_INDIRECT_PAYMENTS"           ,      
    "ACTUALS_AP_FIXED_TRADE_CUST_INVOICED"           ,      
    "ACTUALS_AP_TOTAL_TRADE_CUST_INVOICED"           ,      
    "ACTUALS_AP_FIXED_TRADE_NON_CUST_INVOICED"           ,      
    "ACTUALS_AP_TOTAL_TRADE"           ,      
    "ACTUALS_AP_NET_REALISABLE_REVENUE"           ,      
    "ACTUALS_AP_TOT_PRIME_COST_STANDARD"           ,      
    "ACTUALS_AP_GROSS_MARGIN_STANDARD"           ,      
    "ACTUALS_AP_GCAT_STANDARD"           ,      
    "ACTUALS_RETAIL_TOT_VOL_KG"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_MRRSP"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_RSP"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_NET"           ,      
    "ACTUALS_AP_RETAIL_COST_OF_SALES"           ,      
    "ACTUALS_AP_RETAIL_RETAILER_RETRO_FUNDING"           ,      
    "ACTUALS_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING"           ,      
    "ACTUALS_AP_RETAIL_PROMO_FIXED_SPEND"           ,      
    "ACTUALS_AP_RETAIL_TOTAL_SPEND"           ,      
    "ACTUALS_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_MRRSP"           ,      
    "ACTUALS_AP_RETAIL_REVENUE_NET_EXCL_RSP"           ,      
    "BASE_AP_GROSS_SALES_VALUE"           ,      
    "BASE_AP_RANGE_SUPPORT_ALLOWANCE"           ,      
    "BASE_AP_EVERYDAY_LOW_PRICES"           ,      
    "BASE_AP_PERMANENT_DISC"           ,      
    "BASE_AP_OFF_INVOICE_DISC"           ,      
    "BASE_AP_INVOICED_SALES_VALUE"           ,      
    "BASE_AP_EARLY_SETTLEMENT_DISC"           ,      
    "BASE_AP_GROWTH_INCENTIVES"           ,      
    "BASE_AP_NET_SALES_VALUE"           ,      
    "BASE_AP_RETRO"           ,      
    "BASE_AP_AVP_DISC"           ,      
    "BASE_AP_VARIABLE_TRADE"           ,      
    "BASE_AP_PROMO_FIXED_FUNDING"           ,      
    "BASE_AP_RANGE_SUPPORT_INCENTIVES"           ,      
    "BASE_AP_NET_NET_SALES_VALUE"           ,      
    "BASE_AP_DIRECT_SHOPPER_MARKETING"           ,      
    "BASE_AP_OTHER_DIRECT_PAYMENTS"           ,      
    "BASE_AP_INDIRECT_SHOPPER_MARKETING"           ,      
    "BASE_AP_OTHER_INDIRECT_PAYMENTS"           ,      
    "BASE_AP_FIXED_TRADE_CUST_INVOICED"           ,      
    "BASE_AP_TOTAL_TRADE_CUST_INVOICED"           ,      
    "BASE_AP_FIXED_TRADE_NON_CUST_INVOICED"           ,      
    "BASE_AP_TOTAL_TRADE"           ,      
    "BASE_AP_NET_REALISABLE_REVENUE"           ,      
    "BASE_AP_TOT_PRIME_COST_STANDARD"           ,      
    "BASE_AP_GROSS_MARGIN_STANDARD"           ,      
    "BASE_AP_GCAT_STANDARD"           ,      
    "BASE_RETAIL_TOT_VOL_KG"           ,      
    "BASE_AP_RETAIL_REVENUE_MRRSP"           ,      
    "BASE_AP_RETAIL_REVENUE_RSP"           ,      
    "BASE_AP_RETAIL_REVENUE_NET"           ,      
    "BASE_AP_RETAIL_COST_OF_SALES"           ,      
    "BASE_AP_RETAIL_RETAILER_RETRO_FUNDING"           ,      
    "BASE_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING"           ,      
    "BASE_AP_RETAIL_PROMO_FIXED_SPEND"           ,      
    "BASE_AP_RETAIL_TOTAL_SPEND"           ,      
    "BASE_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING"           ,      
    "BASE_AP_RETAIL_REVENUE_NET_EXCL_MRRSP"           ,      
    "BASE_AP_RETAIL_REVENUE_NET_EXCL_RSP"           ,      
    "FORECAST_AP_GROSS_SALES_VALUE"           ,      
    "FORECAST_AP_RANGE_SUPPORT_ALLOWANCE"           ,      
    "FORECAST_AP_EVERYDAY_LOW_PRICES"           ,      
    "FORECAST_AP_PERMANENT_DISC"           ,      
    "FORECAST_AP_OFF_INVOICE_DISC"           ,      
    "FORECAST_AP_INVOICED_SALES_VALUE"           ,      
    "FORECAST_AP_EARLY_SETTLEMENT_DISC"           ,      
    "FORECAST_AP_GROWTH_INCENTIVES"           ,      
    "FORECAST_AP_NET_SALES_VALUE"           ,      
    "FORECAST_AP_RETRO"           ,      
    "FORECAST_AP_AVP_DISC"           ,      
    "FORECAST_AP_VARIABLE_TRADE"           ,      
    "FORECAST_AP_PROMO_FIXED_FUNDING"           ,      
    "FORECAST_AP_RANGE_SUPPORT_INCENTIVES"           ,      
    "FORECAST_AP_NET_NET_SALES_VALUE"           ,      
    "FORECAST_AP_DIRECT_SHOPPER_MARKETING"           ,      
    "FORECAST_AP_OTHER_DIRECT_PAYMENTS"           ,      
    "FORECAST_AP_INDIRECT_SHOPPER_MARKETING"           ,      
    "FORECAST_AP_OTHER_INDIRECT_PAYMENTS"           ,      
    "FORECAST_AP_FIXED_TRADE_CUST_INVOICED"           ,      
    "FORECAST_AP_TOTAL_TRADE_CUST_INVOICED"           ,      
    "FORECAST_AP_FIXED_TRADE_NON_CUST_INVOICED"           ,      
    "FORECAST_AP_TOTAL_TRADE"           ,      
    "FORECAST_AP_TOTAL_TRADE_GBP"           ,      
    "FORECAST_AP_NET_REALISABLE_REVENUE"           ,      
    "FORECAST_AP_TOT_PRIME_COST_STANDARD"           ,      
    "FORECAST_AP_GROSS_MARGIN_STANDARD"           ,      
    "FORECAST_AP_GCAT_STANDARD"           ,      
    "FORECAST_RETAIL_TOT_VOL_KG"           ,      
    "FORECAST_AP_RETAIL_REVENUE_MRRSP"           ,      
    "FORECAST_AP_RETAIL_REVENUE_RSP"           ,      
    "FORECAST_AP_RETAIL_REVENUE_NET"           ,      
    "FORECAST_AP_RETAIL_COST_OF_SALES"           ,      
    "FORECAST_AP_RETAIL_RETAILER_RETRO_FUNDING"           ,      
    "FORECAST_AP_RETAIL_MARGIN_EXCL_FIXED_FUNDING"           ,      
    "FORECAST_AP_RETAIL_PROMO_FIXED_SPEND"           ,      
    "FORECAST_AP_RETAIL_TOTAL_SPEND"           ,      
    "FORECAST_AP_RETAIL_MARGIN_INCL_FIXED_FUNDING"           ,      
    "FORECAST_AP_RETAIL_REVENUE_NET_EXCL_MRRSP"           ,      
    "FORECAST_AP_RETAIL_REVENUE_NET_EXCL_RSP"           ,      
    "ACTUALS_TOT_VOL_CA"           ,      
    "ACTUALS_TOT_VOL_UL"           ,      
    "BASE_TOT_VOL_CA"           ,      
    "BASE_TOT_VOL_UL"           ,      
    "FORECAST_TOT_VOL_CA"           ,      
    "FORECAST_TOT_VOL_UL"           ,      
    "PRM_ACTUALS_TOT_VOL_CU"           ,      
    "PRM_BASE_TOT_VOL_CU"           ,      
    "PRM_FORECAST_TOT_VOL_CU"           ,      
    "PRM_SI_B_VOL_CU"           ,      
    "PRM_SI_A_VOL_CU"           ,      
    "PRM_SI_T_VOL_CU"           ,      
    "PRM_SI_M_VOL_CU"           ,      
    "PRM_SI_I_VOL_CU"           ,      
    "PRM_ACTUALS_TOT_VOL_PK"           ,      
    "PRM_BASE_TOT_VOL_PK"           ,      
    "PRM_FORECAST_TOT_VOL_PK"           ,      
    "PRM_SI_B_VOL_PK"           ,      
    "PRM_SI_A_VOL_PK"           ,      
    "PRM_SI_T_VOL_PK"           ,      
    "PRM_SI_M_VOL_PK"           ,      
    "PRM_SI_I_VOL_PK"           ,      
    "PROMO_ID"           ,      
    "PROMO_CODE"           ,      
    "PROMO_DESC"           ,      
    "PROMO_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DESC"           ,      
    "PROMO_SUB_TACTIC_DISCOUNT"           ,      
    "PROMO_SUB_TACTIC_ISACTIVE"           ,      
    "PROMO_STAT_DESC"           ,      
    "PROMO_PHASE_DESC"           ,      
    trunc("PROMO_PHASE_LENGTH"  )  PROMO_PHASE_LENGTH       ,      
    "PROMO_PHASE_EFFECT_DESC"           ,      
    "PROMO_PHASE_TYPE_DESC"           ,      
    "PROMO_PHASE_TYPE_UNIT"           ,      
    "AUTHORIZED_USER_NAME"           ,      
    "BUY_IN_START_DT"           ,      
    "BUY_IN_END_DT"           ,      
    "IN_STORE_START_DT"           ,      
    "IN_STORE_END_DT"           ,      
    "PERFORMANCE_START_DT"           ,      
    "PERFORMANCE_END_DT"           ,      
    "FEATURE"           ,      
    "FEATURE_DESC"           ,      
    "PROMO_MECHANIC_NAME"           ,      
    "MARKET"           ,      
    "SUBMARKET"           ,      
    "TRADE_CLASS"           ,      
    "TRADE_GROUP"           ,      
    "TRADE_TYPE"           ,      
    "TRADE_SECTOR"           ,      
    "DESCRIPTION"           ,      
    "ITEM_TYPE"           ,      
    "BRANDING_DESC"           ,      
    "PRODUCT_CLASS_DESC"           ,      
    "SUB_PRODUCT_DESC"           ,      
    "STRATEGIC_DESC"           ,      
    "POWER_BRAND_DESC"           ,      
    "MANUFACTURING_GROUP_DESC"           ,      
    "CATEGORY_DESC"           ,      
    "PACK_SIZE_DESC"           ,      
    "SUB_CATEGORY_DESC"           ,      
    "PROMO_TYPE_DESC"           ,      
    "REPORT_FISCAL_YEAR"           ,      
    "REPORT_FISCAL_YEAR_PERIOD_NO"           ,      
    "FISCAL_YEAR_BEGIN_DT"           ,      
    "FISCAL_YEAR_END_DT"           ,      
    "PLANNING_WEEK_CODE"           ,      
    "PLANNING_WEEK_START_DT"           ,      
    "PLANNING_WEEK_END_DT"           ,      
    "PLANNING_WEEK_NO"           ,      
    "PLANNING_MONTH_CODE"           ,      
    "PLANNING_MONTH_START_DT"           ,      
    "PLANNING_MONTH_END_DT"           ,      
    "PLANNING_QUARTER_NO"           ,      
    "PLANNING_QUARTER_START_DT"           ,      
    "PLANNING_QUARTER_END_DT"           ,      
    "PLANNING_YEAR_NO"           ,      
    "PLANNING_YEAR_START_DT"           ,      
    "PLANNING_YEAR_END_DT"           ,      
    "BILL_NAME"      
  

from {{ref('v_sls_wtx_promo_summary')}}


),

a_intersect_b as (

    select * from a
    

    intersect


    select * from b

),

a_except_b as (

    select * from a
    

    except


    select * from b

),
--select * from a_except_b limit 10;
b_except_a as (

    select * from b
    

    except


    select * from a

),

all_records as (

    select
        *,
        true as in_a,
        true as in_b
    from a_intersect_b

    union all

    select
        *,
        true as in_a,
        false as in_b
    from a_except_b

    union all

    select
        *,
        false as in_a,
        true as in_b
    from b_except_a

),

summary_stats as (

    select

        in_a,
        in_b,
        count(*) as count

    from all_records
    group by 1, 2

),

final as (

    select

        *,
        round(100.0 * count / sum(count) over (), 2) as percent_of_total

    from summary_stats
    order by in_a desc, in_b desc

)
select * from final
